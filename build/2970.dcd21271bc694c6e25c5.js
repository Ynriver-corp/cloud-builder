"use strict";(self.webpackChunkcloud_builder=self.webpackChunkcloud_builder||[]).push([[2970],{30653:function(e,t,n){n.d(t,{p:function(){return i}});class i{constructor(e,t,n,i,r,s){this.id=e,this.label=t,this.alias=n,this._precondition=i,this._run=r,this._contextKeyService=s}isSupported(){return this._contextKeyService.contextMatchesRules(this._precondition)}run(){return this.isSupported()?this._run():Promise.resolve(void 0)}}},96518:function(e,t,n){function i(e){return e&&"string"==typeof e.id}n.d(t,{I:function(){return i},g:function(){return r}});const r={ICodeEditor:"vs.editor.ICodeEditor",IDiffEditor:"vs.editor.IDiffEditor"}},29102:function(e,t,n){n.d(t,{u:function(){return i}});var i,r=n(63580),s=n(38819);!function(e){e.editorSimpleInput=new s.uy("editorSimpleInput",!1,!0),e.editorTextFocus=new s.uy("editorTextFocus",!1,r.N("editorTextFocus","Whether the editor text has focus (cursor is blinking)")),e.focus=new s.uy("editorFocus",!1,r.N("editorFocus","Whether the editor or an editor widget has focus (e.g. focus is in the find widget)")),e.textInputFocus=new s.uy("textInputFocus",!1,r.N("textInputFocus","Whether an editor or a rich text input has focus (cursor is blinking)")),e.readOnly=new s.uy("editorReadonly",!1,r.N("editorReadonly","Whether the editor is read only")),e.inDiffEditor=new s.uy("inDiffEditor",!1,r.N("inDiffEditor","Whether the context is a diff editor")),e.columnSelection=new s.uy("editorColumnSelection",!1,r.N("editorColumnSelection","Whether `editor.columnSelection` is enabled")),e.writable=e.readOnly.toNegated(),e.hasNonEmptySelection=new s.uy("editorHasSelection",!1,r.N("editorHasSelection","Whether the editor has text selected")),e.hasOnlyEmptySelection=e.hasNonEmptySelection.toNegated(),e.hasMultipleSelections=new s.uy("editorHasMultipleSelections",!1,r.N("editorHasMultipleSelections","Whether the editor has multiple selections")),e.hasSingleSelection=e.hasMultipleSelections.toNegated(),e.tabMovesFocus=new s.uy("editorTabMovesFocus",!1,r.N("editorTabMovesFocus","Whether `Tab` will move focus out of the editor")),e.tabDoesNotMoveFocus=e.tabMovesFocus.toNegated(),e.isInWalkThroughSnippet=new s.uy("isInEmbeddedEditor",!1,!0),e.canUndo=new s.uy("canUndo",!1,!0),e.canRedo=new s.uy("canRedo",!1,!0),e.hoverVisible=new s.uy("editorHoverVisible",!1,r.N("editorHoverVisible","Whether the editor hover is visible")),e.inCompositeEditor=new s.uy("inCompositeEditor",void 0,r.N("inCompositeEditor","Whether the editor is part of a larger editor (e.g. notebooks)")),e.notInCompositeEditor=e.inCompositeEditor.toNegated(),e.languageId=new s.uy("editorLangId","",r.N("editorLangId","The language identifier of the editor")),e.hasCompletionItemProvider=new s.uy("editorHasCompletionItemProvider",!1,r.N("editorHasCompletionItemProvider","Whether the editor has a completion item provider")),e.hasCodeActionsProvider=new s.uy("editorHasCodeActionsProvider",!1,r.N("editorHasCodeActionsProvider","Whether the editor has a code actions provider")),e.hasCodeLensProvider=new s.uy("editorHasCodeLensProvider",!1,r.N("editorHasCodeLensProvider","Whether the editor has a code lens provider")),e.hasDefinitionProvider=new s.uy("editorHasDefinitionProvider",!1,r.N("editorHasDefinitionProvider","Whether the editor has a definition provider")),e.hasDeclarationProvider=new s.uy("editorHasDeclarationProvider",!1,r.N("editorHasDeclarationProvider","Whether the editor has a declaration provider")),e.hasImplementationProvider=new s.uy("editorHasImplementationProvider",!1,r.N("editorHasImplementationProvider","Whether the editor has an implementation provider")),e.hasTypeDefinitionProvider=new s.uy("editorHasTypeDefinitionProvider",!1,r.N("editorHasTypeDefinitionProvider","Whether the editor has a type definition provider")),e.hasHoverProvider=new s.uy("editorHasHoverProvider",!1,r.N("editorHasHoverProvider","Whether the editor has a hover provider")),e.hasDocumentHighlightProvider=new s.uy("editorHasDocumentHighlightProvider",!1,r.N("editorHasDocumentHighlightProvider","Whether the editor has a document highlight provider")),e.hasDocumentSymbolProvider=new s.uy("editorHasDocumentSymbolProvider",!1,r.N("editorHasDocumentSymbolProvider","Whether the editor has a document symbol provider")),e.hasReferenceProvider=new s.uy("editorHasReferenceProvider",!1,r.N("editorHasReferenceProvider","Whether the editor has a reference provider")),e.hasRenameProvider=new s.uy("editorHasRenameProvider",!1,r.N("editorHasRenameProvider","Whether the editor has a rename provider")),e.hasSignatureHelpProvider=new s.uy("editorHasSignatureHelpProvider",!1,r.N("editorHasSignatureHelpProvider","Whether the editor has a signature help provider")),e.hasInlayHintsProvider=new s.uy("editorHasInlayHintsProvider",!1,r.N("editorHasInlayHintsProvider","Whether the editor has an inline hints provider")),e.hasDocumentFormattingProvider=new s.uy("editorHasDocumentFormattingProvider",!1,r.N("editorHasDocumentFormattingProvider","Whether the editor has a document formatting provider")),e.hasDocumentSelectionFormattingProvider=new s.uy("editorHasDocumentSelectionFormattingProvider",!1,r.N("editorHasDocumentSelectionFormattingProvider","Whether the editor has a document selection formatting provider")),e.hasMultipleDocumentFormattingProvider=new s.uy("editorHasMultipleDocumentFormattingProvider",!1,r.N("editorHasMultipleDocumentFormattingProvider","Whether the editor has multiple document formatting providers")),e.hasMultipleDocumentSelectionFormattingProvider=new s.uy("editorHasMultipleDocumentSelectionFormattingProvider",!1,r.N("editorHasMultipleDocumentSelectionFormattingProvider","Whether the editor has multiple document selection formatting providers"))}(i||(i={}))},84973:function(e,t,n){var i,r;n.d(t,{sh:function(){return i},F5:function(){return r},dJ:function(){return s},tk:function(){return o},Qi:function(){return a},je:function(){return l}}),function(e){e[e.Left=1]="Left",e[e.Center=2]="Center",e[e.Right=4]="Right",e[e.Full=7]="Full"}(i||(i={})),function(e){e[e.Inline=1]="Inline",e[e.Gutter=2]="Gutter"}(r||(r={}));class s{constructor(e){this._textModelResolvedOptionsBrand=void 0,this.tabSize=Math.max(1,0|e.tabSize),this.indentSize=0|e.tabSize,this.insertSpaces=Boolean(e.insertSpaces),this.defaultEOL=0|e.defaultEOL,this.trimAutoWhitespace=Boolean(e.trimAutoWhitespace)}equals(e){return this.tabSize===e.tabSize&&this.indentSize===e.indentSize&&this.insertSpaces===e.insertSpaces&&this.defaultEOL===e.defaultEOL&&this.trimAutoWhitespace===e.trimAutoWhitespace}createChangeEvent(e){return{tabSize:this.tabSize!==e.tabSize,indentSize:this.indentSize!==e.indentSize,insertSpaces:this.insertSpaces!==e.insertSpaces,trimAutoWhitespace:this.trimAutoWhitespace!==e.trimAutoWhitespace}}}class o{constructor(e,t){this._findMatchBrand=void 0,this.range=e,this.matches=t}}class a{constructor(e,t,n,i,r,s){this.identifier=e,this.range=t,this.text=n,this.forceMoveMarkers=i,this.isAutoWhitespaceEdit=r,this._isTracked=s}}class l{constructor(e,t,n){this.reverseEdits=e,this.changes=t,this.trimAutoWhitespaceLineNumbers=n}}},95215:function(e,t,n){n.d(t,{e9:function(){return g},NL:function(){return _}});var i=n(63580),r=n(17301),s=n(3860),o=n(70666),a=n(60962),l=n(53060),h=n(95935);function u(e){return e.toString()}class c{constructor(e,t,n,i,r,s,o){this.beforeVersionId=e,this.afterVersionId=t,this.beforeEOL=n,this.afterEOL=i,this.beforeCursorState=r,this.afterCursorState=s,this.changes=o}static create(e,t){const n=e.getAlternativeVersionId(),i=f(e);return new c(n,n,i,i,t,t,[])}append(e,t,n,i,r){t.length>0&&(this.changes=(0,a.b)(this.changes,t)),this.afterEOL=n,this.afterVersionId=i,this.afterCursorState=r}static _writeSelectionsSize(e){return 4+16*(e?e.length:0)}static _writeSelections(e,t,n){if(l.T4(e,t?t.length:0,n),n+=4,t)for(const i of t)l.T4(e,i.selectionStartLineNumber,n),n+=4,l.T4(e,i.selectionStartColumn,n),n+=4,l.T4(e,i.positionLineNumber,n),n+=4,l.T4(e,i.positionColumn,n),n+=4;return n}static _readSelections(e,t,n){const i=l.Ag(e,t);t+=4;for(let r=0;r<i;r++){const i=l.Ag(e,t);t+=4;const r=l.Ag(e,t);t+=4;const o=l.Ag(e,t);t+=4;const a=l.Ag(e,t);t+=4,n.push(new s.Y(i,r,o,a))}return t}serialize(){let e=10+c._writeSelectionsSize(this.beforeCursorState)+c._writeSelectionsSize(this.afterCursorState)+4;for(const t of this.changes)e+=t.writeSize();const t=new Uint8Array(e);let n=0;l.T4(t,this.beforeVersionId,n),n+=4,l.T4(t,this.afterVersionId,n),n+=4,l.Cg(t,this.beforeEOL,n),n+=1,l.Cg(t,this.afterEOL,n),n+=1,n=c._writeSelections(t,this.beforeCursorState,n),n=c._writeSelections(t,this.afterCursorState,n),l.T4(t,this.changes.length,n),n+=4;for(const e of this.changes)n=e.write(t,n);return t.buffer}static deserialize(e){const t=new Uint8Array(e);let n=0;const i=l.Ag(t,n);n+=4;const r=l.Ag(t,n);n+=4;const s=l.Q$(t,n);n+=1;const o=l.Q$(t,n);n+=1;const h=[];n=c._readSelections(t,n,h);const u=[];n=c._readSelections(t,n,u);const d=l.Ag(t,n);n+=4;const f=[];for(let e=0;e<d;e++)n=a.q.read(t,n,f);return new c(i,r,s,o,h,u,f)}}class d{constructor(e,t){this.model=e,this._data=c.create(e,t)}get type(){return 0}get resource(){return o.o.isUri(this.model)?this.model:this.model.uri}get label(){return i.N("edit","Typing")}toString(){return(this._data instanceof c?this._data:c.deserialize(this._data)).changes.map((e=>e.toString())).join(", ")}matchesResource(e){return(o.o.isUri(this.model)?this.model:this.model.uri).toString()===e.toString()}setModel(e){this.model=e}canAppend(e){return this.model===e&&this._data instanceof c}append(e,t,n,i,r){this._data instanceof c&&this._data.append(e,t,n,i,r)}close(){this._data instanceof c&&(this._data=this._data.serialize())}open(){this._data instanceof c||(this._data=c.deserialize(this._data))}undo(){if(o.o.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof c&&(this._data=this._data.serialize());const e=c.deserialize(this._data);this.model._applyUndo(e.changes,e.beforeEOL,e.beforeVersionId,e.beforeCursorState)}redo(){if(o.o.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof c&&(this._data=this._data.serialize());const e=c.deserialize(this._data);this.model._applyRedo(e.changes,e.afterEOL,e.afterVersionId,e.afterCursorState)}heapSize(){return this._data instanceof c&&(this._data=this._data.serialize()),this._data.byteLength+168}}function f(e){return"\n"===e.getEOL()?0:1}function g(e){return!!e&&(e instanceof d||e instanceof class{constructor(e,t){this.type=1,this.label=e,this._isOpen=!0,this._editStackElementsArr=t.slice(0),this._editStackElementsMap=new Map;for(const e of this._editStackElementsArr){const t=u(e.resource);this._editStackElementsMap.set(t,e)}this._delegate=null}get resources(){return this._editStackElementsArr.map((e=>e.resource))}prepareUndoRedo(){if(this._delegate)return this._delegate.prepareUndoRedo(this)}matchesResource(e){const t=u(e);return this._editStackElementsMap.has(t)}setModel(e){const t=u(o.o.isUri(e)?e:e.uri);this._editStackElementsMap.has(t)&&this._editStackElementsMap.get(t).setModel(e)}canAppend(e){if(!this._isOpen)return!1;const t=u(e.uri);return!!this._editStackElementsMap.has(t)&&this._editStackElementsMap.get(t).canAppend(e)}append(e,t,n,i,r){const s=u(e.uri);this._editStackElementsMap.get(s).append(e,t,n,i,r)}close(){this._isOpen=!1}open(){}undo(){this._isOpen=!1;for(const e of this._editStackElementsArr)e.undo()}redo(){for(const e of this._editStackElementsArr)e.redo()}heapSize(e){const t=u(e);return this._editStackElementsMap.has(t)?this._editStackElementsMap.get(t).heapSize():0}split(){return this._editStackElementsArr}toString(){let e=[];for(const t of this._editStackElementsArr)e.push(`${(0,h.EZ)(t.resource)}: ${t}`);return`{${e.join(", ")}}`}})}class _{constructor(e,t){this._model=e,this._undoRedoService=t}pushStackElement(){const e=this._undoRedoService.getLastElement(this._model.uri);g(e)&&e.close()}popStackElement(){const e=this._undoRedoService.getLastElement(this._model.uri);g(e)&&e.open()}clear(){this._undoRedoService.removeElements(this._model.uri)}_getOrCreateEditStackElement(e){const t=this._undoRedoService.getLastElement(this._model.uri);if(g(t)&&t.canAppend(this._model))return t;const n=new d(this._model,e);return this._undoRedoService.pushElement(n),n}pushEOL(e){const t=this._getOrCreateEditStackElement(null);this._model.setEOL(e),t.append(this._model,[],f(this._model),this._model.getAlternativeVersionId(),null)}pushEditOperation(e,t,n){const i=this._getOrCreateEditStackElement(e),r=this._model.applyEdits(t,!0),s=_._computeCursorState(n,r),o=r.map(((e,t)=>({index:t,textChange:e.textChange})));return o.sort(((e,t)=>e.textChange.oldPosition===t.textChange.oldPosition?e.index-t.index:e.textChange.oldPosition-t.textChange.oldPosition)),i.append(this._model,o.map((e=>e.textChange)),f(this._model),this._model.getAlternativeVersionId(),s),s}static _computeCursorState(e,t){try{return e?e(t):null}catch(e){return(0,r.dL)(e),null}}}},29981:function(e,t,n){n.d(t,{v:function(){return o}});var i=n(97295),r=n(50187),s=n(3544);class o{constructor(e,t,n,i){this._uri=e,this._lines=t,this._eol=n,this._versionId=i,this._lineStarts=null,this._cachedTextValue=null}dispose(){this._lines.length=0}get version(){return this._versionId}getText(){return null===this._cachedTextValue&&(this._cachedTextValue=this._lines.join(this._eol)),this._cachedTextValue}onEvents(e){e.eol&&e.eol!==this._eol&&(this._eol=e.eol,this._lineStarts=null);const t=e.changes;for(const e of t)this._acceptDeleteRange(e.range),this._acceptInsertText(new r.L(e.range.startLineNumber,e.range.startColumn),e.text);this._versionId=e.versionId,this._cachedTextValue=null}_ensureLineStarts(){if(!this._lineStarts){const e=this._eol.length,t=this._lines.length,n=new Uint32Array(t);for(let i=0;i<t;i++)n[i]=this._lines[i].length+e;this._lineStarts=new s.o(n)}}_setLineText(e,t){this._lines[e]=t,this._lineStarts&&this._lineStarts.changeValue(e,this._lines[e].length+this._eol.length)}_acceptDeleteRange(e){if(e.startLineNumber!==e.endLineNumber)this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.endLineNumber-1].substring(e.endColumn-1)),this._lines.splice(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineStarts&&this._lineStarts.removeValues(e.startLineNumber,e.endLineNumber-e.startLineNumber);else{if(e.startColumn===e.endColumn)return;this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.startLineNumber-1].substring(e.endColumn-1))}}_acceptInsertText(e,t){if(0===t.length)return;let n=(0,i.uq)(t);if(1===n.length)return void this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]+this._lines[e.lineNumber-1].substring(e.column-1));n[n.length-1]+=this._lines[e.lineNumber-1].substring(e.column-1),this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]);let r=new Uint32Array(n.length-1);for(let t=1;t<n.length;t++)this._lines.splice(e.lineNumber+t-1,0,n[t]),r[t-1]=n[t].length+this._eol.length;this._lineStarts&&this._lineStarts.insertValues(e.lineNumber,r)}}},60962:function(e,t,n){n.d(t,{q:function(){return o},b:function(){return a}});var i=n(53060),r=n(50072);function s(e){return e.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}class o{constructor(e,t,n,i){this.oldPosition=e,this.oldText=t,this.newPosition=n,this.newText=i}get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}toString(){return 0===this.oldText.length?`(insert@${this.oldPosition} "${s(this.newText)}")`:0===this.newText.length?`(delete@${this.oldPosition} "${s(this.oldText)}")`:`(replace@${this.oldPosition} "${s(this.oldText)}" with "${s(this.newText)}")`}static _writeStringSize(e){return 4+2*e.length}static _writeString(e,t,n){const r=t.length;i.T4(e,r,n),n+=4;for(let s=0;s<r;s++)i.oq(e,t.charCodeAt(s),n),n+=2;return n}static _readString(e,t){const n=i.Ag(e,t);return t+=4,(0,r.kH)(e,t,n)}writeSize(){return 8+o._writeStringSize(this.oldText)+o._writeStringSize(this.newText)}write(e,t){return i.T4(e,this.oldPosition,t),t+=4,i.T4(e,this.newPosition,t),t+=4,t=o._writeString(e,this.oldText,t),t=o._writeString(e,this.newText,t)}static read(e,t,n){const r=i.Ag(e,t);t+=4;const s=i.Ag(e,t);t+=4;const a=o._readString(e,t);t+=o._writeStringSize(a);const l=o._readString(e,t);return t+=o._writeStringSize(l),n.push(new o(r,a,s,l)),t}}function a(e,t){if(null===e||0===e.length)return t;return new l(e,t).compress()}class l{constructor(e,t){this._prevEdits=e,this._currEdits=t,this._result=[],this._resultLen=0,this._prevLen=this._prevEdits.length,this._prevDeltaOffset=0,this._currLen=this._currEdits.length,this._currDeltaOffset=0}compress(){let e=0,t=0,n=this._getPrev(e),i=this._getCurr(t);for(;e<this._prevLen||t<this._currLen;){if(null===n){this._acceptCurr(i),i=this._getCurr(++t);continue}if(null===i){this._acceptPrev(n),n=this._getPrev(++e);continue}if(i.oldEnd<=n.newPosition){this._acceptCurr(i),i=this._getCurr(++t);continue}if(n.newEnd<=i.oldPosition){this._acceptPrev(n),n=this._getPrev(++e);continue}if(i.oldPosition<n.newPosition){const[e,t]=l._splitCurr(i,n.newPosition-i.oldPosition);this._acceptCurr(e),i=t;continue}if(n.newPosition<i.oldPosition){const[e,t]=l._splitPrev(n,i.oldPosition-n.newPosition);this._acceptPrev(e),n=t;continue}let r,s;if(i.oldEnd===n.newEnd)r=n,s=i,n=this._getPrev(++e),i=this._getCurr(++t);else if(i.oldEnd<n.newEnd){const[e,o]=l._splitPrev(n,i.oldLength);r=e,s=i,n=o,i=this._getCurr(++t)}else{const[t,o]=l._splitCurr(i,n.newLength);r=n,s=t,n=this._getPrev(++e),i=o}this._result[this._resultLen++]=new o(r.oldPosition,r.oldText,s.newPosition,s.newText),this._prevDeltaOffset+=r.newLength-r.oldLength,this._currDeltaOffset+=s.newLength-s.oldLength}const r=l._merge(this._result);return l._removeNoOps(r)}_acceptCurr(e){this._result[this._resultLen++]=l._rebaseCurr(this._prevDeltaOffset,e),this._currDeltaOffset+=e.newLength-e.oldLength}_getCurr(e){return e<this._currLen?this._currEdits[e]:null}_acceptPrev(e){this._result[this._resultLen++]=l._rebasePrev(this._currDeltaOffset,e),this._prevDeltaOffset+=e.newLength-e.oldLength}_getPrev(e){return e<this._prevLen?this._prevEdits[e]:null}static _rebaseCurr(e,t){return new o(t.oldPosition-e,t.oldText,t.newPosition,t.newText)}static _rebasePrev(e,t){return new o(t.oldPosition,t.oldText,t.newPosition+e,t.newText)}static _splitPrev(e,t){const n=e.newText.substr(0,t),i=e.newText.substr(t);return[new o(e.oldPosition,e.oldText,e.newPosition,n),new o(e.oldEnd,"",e.newPosition+t,i)]}static _splitCurr(e,t){const n=e.oldText.substr(0,t),i=e.oldText.substr(t);return[new o(e.oldPosition,n,e.newPosition,e.newText),new o(e.oldPosition+t,i,e.newEnd,"")]}static _merge(e){if(0===e.length)return e;let t=[],n=0,i=e[0];for(let r=1;r<e.length;r++){const s=e[r];i.oldEnd===s.oldPosition?i=new o(i.oldPosition,i.oldText+s.oldText,i.newPosition,i.newText+s.newText):(t[n++]=i,i=s)}return t[n++]=i,t}static _removeNoOps(e){if(0===e.length)return e;let t=[],n=0;for(let i=0;i<e.length;i++){const r=e[i];r.oldText!==r.newText&&(t[n++]=r)}return t}}},83103:function(e,t,n){n.d(t,{qx:function(){return je},yO:function(){return ze}});var i=n(17301),r=n(4669),s=n(5976),o=n(97295),a=n(70666),l=n(64141),h=n(50187),u=n(24314),c=n(3860),d=n(84973),f=n(95215);class g{constructor(){this.spacesDiff=0,this.looksLikeAlignment=!1}}function _(e,t,n,i,r){let s;for(r.spacesDiff=0,r.looksLikeAlignment=!1,s=0;s<t&&s<i;s++){if(e.charCodeAt(s)!==n.charCodeAt(s))break}let o=0,a=0;for(let n=s;n<t;n++){32===e.charCodeAt(n)?o++:a++}let l=0,h=0;for(let e=s;e<i;e++){32===n.charCodeAt(e)?l++:h++}if(o>0&&a>0)return;if(l>0&&h>0)return;let u=Math.abs(a-h),c=Math.abs(o-l);if(0===u)return r.spacesDiff=c,void(c>0&&0<=l-1&&l-1<e.length&&l<n.length&&32!==n.charCodeAt(l)&&32===e.charCodeAt(l-1)&&44===e.charCodeAt(e.length-1)&&(r.looksLikeAlignment=!0));c%u!=0||(r.spacesDiff=c/u)}function p(e,t,n){const i=Math.min(e.getLineCount(),1e4);let r=0,s=0,o="",a=0;const l=[2,4,6,8,3,5,7];let h=[0,0,0,0,0,0,0,0,0],u=new g;for(let l=1;l<=i;l++){let i=e.getLineLength(l),c=e.getLineContent(l);const d=i<=65536;let f=!1,g=0,p=0,m=0;for(let t=0,n=i;t<n;t++){let n=d?c.charCodeAt(t):e.getLineCharCode(l,t);if(9===n)m++;else{if(32!==n){f=!0,g=t;break}p++}}if(!f)continue;if(m>0?r++:p>1&&s++,_(o,a,c,g,u),u.looksLikeAlignment&&(!n||t!==u.spacesDiff))continue;let L=u.spacesDiff;L<=8&&h[L]++,o=c,a=g}let c=n;r!==s&&(c=r<s);let d=t;if(c){let e=c?0:.1*i;l.forEach((t=>{let n=h[t];n>e&&(e=n,d=t)})),4===d&&h[4]>0&&h[2]>0&&h[2]>=h[4]/2&&(d=2)}return{insertSpaces:c,tabSize:d}}function m(e){return(1&e.metadata)>>>0}function L(e,t){e.metadata=254&e.metadata|t<<0}function C(e){return(2&e.metadata)>>>1==1}function b(e,t){e.metadata=253&e.metadata|(t?1:0)<<1}function N(e){return(4&e.metadata)>>>2==1}function I(e,t){e.metadata=251&e.metadata|(t?1:0)<<2}function v(e,t){e.metadata=231&e.metadata|t<<3}function S(e,t){e.metadata=223&e.metadata|(t?1:0)<<5}class x{constructor(e,t,n){this.metadata=0,this.parent=this,this.left=this,this.right=this,L(this,1),this.start=t,this.end=n,this.delta=0,this.maxEnd=n,this.id=e,this.ownerId=0,this.options=null,I(this,!1),v(this,1),S(this,!1),this.cachedVersionId=0,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=n,this.range=null,b(this,!1)}reset(e,t,n,i){this.start=t,this.end=n,this.maxEnd=n,this.cachedVersionId=e,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=n,this.range=i}setOptions(e){this.options=e;let t=this.options.className;I(this,"squiggly-error"===t||"squiggly-warning"===t||"squiggly-info"===t),v(this,this.options.stickiness),S(this,this.options.collapseOnReplaceEdit)}setCachedOffsets(e,t,n){this.cachedVersionId!==n&&(this.range=null),this.cachedVersionId=n,this.cachedAbsoluteStart=e,this.cachedAbsoluteEnd=t}detach(){this.parent=null,this.left=null,this.right=null}}const w=new x(null,0,0);w.parent=w,w.left=w,w.right=w,L(w,0);class k{constructor(){this.root=w,this.requestNormalizeDelta=!1}intervalSearch(e,t,n,i,r){return this.root===w?[]:function(e,t,n,i,r,s){let o=e.root,a=0,l=0,h=0,u=0,c=[],d=0;for(;o!==w;)if(C(o))b(o.left,!1),b(o.right,!1),o===o.parent.right&&(a-=o.parent.delta),o=o.parent;else{if(!C(o.left)){if(l=a+o.maxEnd,l<t){b(o,!0);continue}if(o.left!==w){o=o.left;continue}}if(h=a+o.start,h>n)b(o,!0);else{if(u=a+o.end,u>=t){o.setCachedOffsets(h,u,s);let e=!0;i&&o.ownerId&&o.ownerId!==i&&(e=!1),r&&N(o)&&(e=!1),e&&(c[d++]=o)}b(o,!0),o.right===w||C(o.right)||(a+=o.delta,o=o.right)}}return b(e.root,!1),c}(this,e,t,n,i,r)}search(e,t,n){return this.root===w?[]:function(e,t,n,i){let r=e.root,s=0,o=0,a=0,l=[],h=0;for(;r!==w;){if(C(r)){b(r.left,!1),b(r.right,!1),r===r.parent.right&&(s-=r.parent.delta),r=r.parent;continue}if(r.left!==w&&!C(r.left)){r=r.left;continue}o=s+r.start,a=s+r.end,r.setCachedOffsets(o,a,i);let e=!0;t&&r.ownerId&&r.ownerId!==t&&(e=!1),n&&N(r)&&(e=!1),e&&(l[h++]=r),b(r,!0),r.right===w||C(r.right)||(s+=r.delta,r=r.right)}return b(e.root,!1),l}(this,e,t,n)}collectNodesFromOwner(e){return function(e,t){let n=e.root,i=[],r=0;for(;n!==w;)C(n)?(b(n.left,!1),b(n.right,!1),n=n.parent):n.left===w||C(n.left)?(n.ownerId===t&&(i[r++]=n),b(n,!0),n.right===w||C(n.right)||(n=n.right)):n=n.left;return b(e.root,!1),i}(this,e)}collectNodesPostOrder(){return function(e){let t=e.root,n=[],i=0;for(;t!==w;)C(t)?(b(t.left,!1),b(t.right,!1),t=t.parent):t.left===w||C(t.left)?t.right===w||C(t.right)?(n[i++]=t,b(t,!0)):t=t.right:t=t.left;return b(e.root,!1),n}(this)}insert(e){D(this,e),this._normalizeDeltaIfNecessary()}delete(e){A(this,e),this._normalizeDeltaIfNecessary()}resolveNode(e,t){const n=e;let i=0;for(;e!==this.root;)e===e.parent.right&&(i+=e.parent.delta),e=e.parent;const r=n.start+i,s=n.end+i;n.setCachedOffsets(r,s,t)}acceptReplace(e,t,n,i){const r=function(e,t,n){let i=e.root,r=0,s=0,o=0,a=0,l=[],h=0;for(;i!==w;)if(C(i))b(i.left,!1),b(i.right,!1),i===i.parent.right&&(r-=i.parent.delta),i=i.parent;else{if(!C(i.left)){if(s=r+i.maxEnd,s<t){b(i,!0);continue}if(i.left!==w){i=i.left;continue}}o=r+i.start,o>n?b(i,!0):(a=r+i.end,a>=t&&(i.setCachedOffsets(o,a,0),l[h++]=i),b(i,!0),i.right===w||C(i.right)||(r+=i.delta,i=i.right))}return b(e.root,!1),l}(this,e,e+t);for(let e=0,t=r.length;e<t;e++){A(this,r[e])}this._normalizeDeltaIfNecessary(),function(e,t,n,i){let r=e.root,s=0,o=0,a=0;const l=i-(n-t);for(;r!==w;)if(C(r))b(r.left,!1),b(r.right,!1),r===r.parent.right&&(s-=r.parent.delta),B(r),r=r.parent;else{if(!C(r.left)){if(o=s+r.maxEnd,o<t){b(r,!0);continue}if(r.left!==w){r=r.left;continue}}a=s+r.start,a>n?(r.start+=l,r.end+=l,r.delta+=l,(r.delta<-1073741824||r.delta>1073741824)&&(e.requestNormalizeDelta=!0),b(r,!0)):(b(r,!0),r.right===w||C(r.right)||(s+=r.delta,r=r.right))}b(e.root,!1)}(this,e,e+t,n),this._normalizeDeltaIfNecessary();for(let s=0,o=r.length;s<o;s++){const o=r[s];o.start=o.cachedAbsoluteStart,o.end=o.cachedAbsoluteEnd,E(o,e,e+t,n,i),o.maxEnd=o.end,D(this,o)}this._normalizeDeltaIfNecessary()}_normalizeDeltaIfNecessary(){this.requestNormalizeDelta&&(this.requestNormalizeDelta=!1,function(e){let t=e.root,n=0;for(;t!==w;)t.left===w||C(t.left)?t.right===w||C(t.right)?(t.start=n+t.start,t.end=n+t.end,t.delta=0,B(t),b(t,!0),b(t.left,!1),b(t.right,!1),t===t.parent.right&&(n-=t.parent.delta),t=t.parent):(n+=t.delta,t=t.right):t=t.left;b(e.root,!1)}(this))}}function T(e,t,n,i){return e<n||!(e>n)&&(1!==i&&(2===i||t))}function E(e,t,n,i,r){const s=function(e){return(24&e.metadata)>>>3}(e),o=0===s||2===s,a=1===s||2===s,l=n-t,h=i,u=Math.min(l,h),c=e.start;let d=!1;const f=e.end;let g=!1;t<=c&&f<=n&&function(e){return(32&e.metadata)>>>5==1}(e)&&(e.start=t,d=!0,e.end=t,g=!0);{const e=r?1:l>0?2:0;!d&&T(c,o,t,e)&&(d=!0),!g&&T(f,a,t,e)&&(g=!0)}if(u>0&&!r){const e=l>h?2:0;!d&&T(c,o,t+u,e)&&(d=!0),!g&&T(f,a,t+u,e)&&(g=!0)}{const i=r?1:0;!d&&T(c,o,n,i)&&(e.start=t+h,d=!0),!g&&T(f,a,n,i)&&(e.end=t+h,g=!0)}const _=h-l;d||(e.start=Math.max(0,c+_)),g||(e.end=Math.max(0,f+_)),e.start>e.end&&(e.end=e.start)}function D(e,t){if(e.root===w)return t.parent=w,t.left=w,t.right=w,L(t,0),e.root=t,e.root;!function(e,t){let n=0,i=e.root;const r=t.start,s=t.end;for(;;){if(P(r,s,i.start+n,i.end+n)<0){if(i.left===w){t.start-=n,t.end-=n,t.maxEnd-=n,i.left=t;break}i=i.left}else{if(i.right===w){t.start-=n+i.delta,t.end-=n+i.delta,t.maxEnd-=n+i.delta,i.right=t;break}n+=i.delta,i=i.right}}t.parent=i,t.left=w,t.right=w,L(t,1)}(e,t),y(t.parent);let n=t;for(;n!==e.root&&1===m(n.parent);)if(n.parent===n.parent.parent.left){const t=n.parent.parent.right;1===m(t)?(L(n.parent,0),L(t,0),L(n.parent.parent,1),n=n.parent.parent):(n===n.parent.right&&(n=n.parent,R(e,n)),L(n.parent,0),L(n.parent.parent,1),M(e,n.parent.parent))}else{const t=n.parent.parent.left;1===m(t)?(L(n.parent,0),L(t,0),L(n.parent.parent,1),n=n.parent.parent):(n===n.parent.left&&(n=n.parent,M(e,n)),L(n.parent,0),L(n.parent.parent,1),R(e,n.parent.parent))}return L(e.root,0),t}function A(e,t){let n,i;if(t.left===w?(n=t.right,i=t,n.delta+=t.delta,(n.delta<-1073741824||n.delta>1073741824)&&(e.requestNormalizeDelta=!0),n.start+=t.delta,n.end+=t.delta):t.right===w?(n=t.left,i=t):(i=function(e){for(;e.left!==w;)e=e.left;return e}(t.right),n=i.right,n.start+=i.delta,n.end+=i.delta,n.delta+=i.delta,(n.delta<-1073741824||n.delta>1073741824)&&(e.requestNormalizeDelta=!0),i.start+=t.delta,i.end+=t.delta,i.delta=t.delta,(i.delta<-1073741824||i.delta>1073741824)&&(e.requestNormalizeDelta=!0)),i===e.root)return e.root=n,L(n,0),t.detach(),O(),B(n),void(e.root.parent=w);let r,s=1===m(i);if(i===i.parent.left?i.parent.left=n:i.parent.right=n,i===t?n.parent=i.parent:(i.parent===t?n.parent=i:n.parent=i.parent,i.left=t.left,i.right=t.right,i.parent=t.parent,L(i,m(t)),t===e.root?e.root=i:t===t.parent.left?t.parent.left=i:t.parent.right=i,i.left!==w&&(i.left.parent=i),i.right!==w&&(i.right.parent=i)),t.detach(),s)return y(n.parent),i!==t&&(y(i),y(i.parent)),void O();for(y(n),y(n.parent),i!==t&&(y(i),y(i.parent));n!==e.root&&0===m(n);)n===n.parent.left?(r=n.parent.right,1===m(r)&&(L(r,0),L(n.parent,1),R(e,n.parent),r=n.parent.right),0===m(r.left)&&0===m(r.right)?(L(r,1),n=n.parent):(0===m(r.right)&&(L(r.left,0),L(r,1),M(e,r),r=n.parent.right),L(r,m(n.parent)),L(n.parent,0),L(r.right,0),R(e,n.parent),n=e.root)):(r=n.parent.left,1===m(r)&&(L(r,0),L(n.parent,1),M(e,n.parent),r=n.parent.left),0===m(r.left)&&0===m(r.right)?(L(r,1),n=n.parent):(0===m(r.left)&&(L(r.right,0),L(r,1),R(e,r),r=n.parent.left),L(r,m(n.parent)),L(n.parent,0),L(r.left,0),M(e,n.parent),n=e.root));L(n,0),O()}function O(){w.parent=w,w.delta=0,w.start=0,w.end=0}function R(e,t){const n=t.right;n.delta+=t.delta,(n.delta<-1073741824||n.delta>1073741824)&&(e.requestNormalizeDelta=!0),n.start+=t.delta,n.end+=t.delta,t.right=n.left,n.left!==w&&(n.left.parent=t),n.parent=t.parent,t.parent===w?e.root=n:t===t.parent.left?t.parent.left=n:t.parent.right=n,n.left=t,t.parent=n,B(t),B(n)}function M(e,t){const n=t.left;t.delta-=n.delta,(t.delta<-1073741824||t.delta>1073741824)&&(e.requestNormalizeDelta=!0),t.start-=n.delta,t.end-=n.delta,t.left=n.right,n.right!==w&&(n.right.parent=t),n.parent=t.parent,t.parent===w?e.root=n:t===t.parent.right?t.parent.right=n:t.parent.left=n,n.right=t,t.parent=n,B(t),B(n)}function z(e){let t=e.end;if(e.left!==w){const n=e.left.maxEnd;n>t&&(t=n)}if(e.right!==w){const n=e.right.maxEnd+e.delta;n>t&&(t=n)}return t}function B(e){e.maxEnd=z(e)}function y(e){for(;e!==w;){const t=z(e);if(e.maxEnd===t)return;e.maxEnd=t,e=e.parent}}function P(e,t,n,i){return e===n?t-i:e-n}class F{constructor(e,t){this.piece=e,this.color=t,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==V)return W(this.right);let e=this;for(;e.parent!==V&&e.parent.left!==e;)e=e.parent;return e.parent===V?V:e.parent}prev(){if(this.left!==V)return U(this.left);let e=this;for(;e.parent!==V&&e.parent.right!==e;)e=e.parent;return e.parent===V?V:e.parent}detach(){this.parent=null,this.left=null,this.right=null}}const V=new F(null,0);function W(e){for(;e.left!==V;)e=e.left;return e}function U(e){for(;e.right!==V;)e=e.right;return e}function H(e){return e===V?0:e.size_left+e.piece.length+H(e.right)}function j(e){return e===V?0:e.lf_left+e.piece.lineFeedCnt+j(e.right)}function q(){V.parent=V}function Q(e,t){let n=t.right;n.size_left+=t.size_left+(t.piece?t.piece.length:0),n.lf_left+=t.lf_left+(t.piece?t.piece.lineFeedCnt:0),t.right=n.left,n.left!==V&&(n.left.parent=t),n.parent=t.parent,t.parent===V?e.root=n:t.parent.left===t?t.parent.left=n:t.parent.right=n,n.left=t,t.parent=n}function $(e,t){let n=t.left;t.left=n.right,n.right!==V&&(n.right.parent=t),n.parent=t.parent,t.size_left-=n.size_left+(n.piece?n.piece.length:0),t.lf_left-=n.lf_left+(n.piece?n.piece.lineFeedCnt:0),t.parent===V?e.root=n:t===t.parent.right?t.parent.right=n:t.parent.left=n,n.right=t,t.parent=n}function Z(e,t){let n,i;if(t.left===V?(i=t,n=i.right):t.right===V?(i=t,n=i.left):(i=W(t.right),n=i.right),i===e.root)return e.root=n,n.color=0,t.detach(),q(),void(e.root.parent=V);let r,s=1===i.color;if(i===i.parent.left?i.parent.left=n:i.parent.right=n,i===t?(n.parent=i.parent,Y(e,n)):(i.parent===t?n.parent=i:n.parent=i.parent,Y(e,n),i.left=t.left,i.right=t.right,i.parent=t.parent,i.color=t.color,t===e.root?e.root=i:t===t.parent.left?t.parent.left=i:t.parent.right=i,i.left!==V&&(i.left.parent=i),i.right!==V&&(i.right.parent=i),i.size_left=t.size_left,i.lf_left=t.lf_left,Y(e,i)),t.detach(),n.parent.left===n){let t=H(n),i=j(n);if(t!==n.parent.size_left||i!==n.parent.lf_left){let r=t-n.parent.size_left,s=i-n.parent.lf_left;n.parent.size_left=t,n.parent.lf_left=i,J(e,n.parent,r,s)}}if(Y(e,n.parent),s)q();else{for(;n!==e.root&&0===n.color;)n===n.parent.left?(r=n.parent.right,1===r.color&&(r.color=0,n.parent.color=1,Q(e,n.parent),r=n.parent.right),0===r.left.color&&0===r.right.color?(r.color=1,n=n.parent):(0===r.right.color&&(r.left.color=0,r.color=1,$(e,r),r=n.parent.right),r.color=n.parent.color,n.parent.color=0,r.right.color=0,Q(e,n.parent),n=e.root)):(r=n.parent.left,1===r.color&&(r.color=0,n.parent.color=1,$(e,n.parent),r=n.parent.left),0===r.left.color&&0===r.right.color?(r.color=1,n=n.parent):(0===r.left.color&&(r.right.color=0,r.color=1,Q(e,r),r=n.parent.left),r.color=n.parent.color,n.parent.color=0,r.left.color=0,$(e,n.parent),n=e.root));n.color=0,q()}}function G(e,t){for(Y(e,t);t!==e.root&&1===t.parent.color;)if(t.parent===t.parent.parent.left){const n=t.parent.parent.right;1===n.color?(t.parent.color=0,n.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.right&&Q(e,t=t.parent),t.parent.color=0,t.parent.parent.color=1,$(e,t.parent.parent))}else{const n=t.parent.parent.left;1===n.color?(t.parent.color=0,n.color=0,t.parent.parent.color=1,t=t.parent.parent):(t===t.parent.left&&$(e,t=t.parent),t.parent.color=0,t.parent.parent.color=1,Q(e,t.parent.parent))}e.root.color=0}function J(e,t,n,i){for(;t!==e.root&&t!==V;)t.parent.left===t&&(t.parent.size_left+=n,t.parent.lf_left+=i),t=t.parent}function Y(e,t){let n=0,i=0;if(t!==e.root){if(0===n){for(;t!==e.root&&t===t.parent.right;)t=t.parent;if(t===e.root)return;n=H((t=t.parent).left)-t.size_left,i=j(t.left)-t.lf_left,t.size_left+=n,t.lf_left+=i}for(;t!==e.root&&(0!==n||0!==i);)t.parent.left===t&&(t.parent.size_left+=n,t.parent.lf_left+=i),t=t.parent}}V.parent=V,V.left=V,V.right=V,V.color=0;var K=n(77277);const X=65535;function ee(e){let t;return t=e[e.length-1]<65536?new Uint16Array(e.length):new Uint32Array(e.length),t.set(e,0),t}class te{constructor(e,t,n,i,r){this.lineStarts=e,this.cr=t,this.lf=n,this.crlf=i,this.isBasicASCII=r}}function ne(e,t=!0){let n=[0],i=1;for(let t=0,r=e.length;t<r;t++){const s=e.charCodeAt(t);13===s?t+1<r&&10===e.charCodeAt(t+1)?(n[i++]=t+2,t++):n[i++]=t+1:10===s&&(n[i++]=t+1)}return t?ee(n):n}class ie{constructor(e,t,n,i,r){this.bufferIndex=e,this.start=t,this.end=n,this.lineFeedCnt=i,this.length=r}}class re{constructor(e,t){this.buffer=e,this.lineStarts=t}}class se{constructor(e,t){this._pieces=[],this._tree=e,this._BOM=t,this._index=0,e.root!==V&&e.iterate(e.root,(e=>(e!==V&&this._pieces.push(e.piece),!0)))}read(){return 0===this._pieces.length?0===this._index?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:0===this._index?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}class oe{constructor(e){this._limit=e,this._cache=[]}get(e){for(let t=this._cache.length-1;t>=0;t--){let n=this._cache[t];if(n.nodeStartOffset<=e&&n.nodeStartOffset+n.node.piece.length>=e)return n}return null}get2(e){for(let t=this._cache.length-1;t>=0;t--){let n=this._cache[t];if(n.nodeStartLineNumber&&n.nodeStartLineNumber<e&&n.nodeStartLineNumber+n.node.piece.lineFeedCnt>=e)return n}return null}set(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}validate(e){let t=!1,n=this._cache;for(let i=0;i<n.length;i++){let r=n[i];(null===r.node.parent||r.nodeStartOffset>=e)&&(n[i]=null,t=!0)}if(t){let e=[];for(const t of n)null!==t&&e.push(t);this._cache=e}}}class ae{constructor(e,t,n){this.create(e,t,n)}create(e,t,n){this._buffers=[new re("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=V,this._lineCnt=1,this._length=0,this._EOL=t,this._EOLLength=t.length,this._EOLNormalized=n;let i=null;for(let t=0,n=e.length;t<n;t++)if(e[t].buffer.length>0){e[t].lineStarts||(e[t].lineStarts=ne(e[t].buffer));let n=new ie(t+1,{line:0,column:0},{line:e[t].lineStarts.length-1,column:e[t].buffer.length-e[t].lineStarts[e[t].lineStarts.length-1]},e[t].lineStarts.length-1,e[t].buffer.length);this._buffers.push(e[t]),i=this.rbInsertRight(i,n)}this._searchCache=new oe(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(e){let t=65535-Math.floor(21845),n=2*t,i="",r=0,s=[];if(this.iterate(this.root,(o=>{let a=this.getNodeContent(o),l=a.length;if(r<=t||r+l<n)return i+=a,r+=l,!0;let h=i.replace(/\r\n|\r|\n/g,e);return s.push(new re(h,ne(h))),i=a,r=l,!0})),r>0){let t=i.replace(/\r\n|\r|\n/g,e);s.push(new re(t,ne(t)))}this.create(s,e,!0)}getEOL(){return this._EOL}setEOL(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}createSnapshot(e){return new se(this,e)}getOffsetAt(e,t){let n=0,i=this.root;for(;i!==V;)if(i.left!==V&&i.lf_left+1>=e)i=i.left;else{if(i.lf_left+i.piece.lineFeedCnt+1>=e){return n+=i.size_left,n+(this.getAccumulatedValue(i,e-i.lf_left-2)+t-1)}e-=i.lf_left+i.piece.lineFeedCnt,n+=i.size_left+i.piece.length,i=i.right}return n}getPositionAt(e){e=Math.floor(e),e=Math.max(0,e);let t=this.root,n=0,i=e;for(;t!==V;)if(0!==t.size_left&&t.size_left>=e)t=t.left;else{if(t.size_left+t.piece.length>=e){let r=this.getIndexOf(t,e-t.size_left);if(n+=t.lf_left+r.index,0===r.index){let e=i-this.getOffsetAt(n+1,1);return new h.L(n+1,e+1)}return new h.L(n+1,r.remainder+1)}if(e-=t.size_left+t.piece.length,n+=t.lf_left+t.piece.lineFeedCnt,t.right===V){let t=i-e-this.getOffsetAt(n+1,1);return new h.L(n+1,t+1)}t=t.right}return new h.L(1,1)}getValueInRange(e,t){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";let n=this.nodeAt2(e.startLineNumber,e.startColumn),i=this.nodeAt2(e.endLineNumber,e.endColumn),r=this.getValueInRange2(n,i);return t?t===this._EOL&&this._EOLNormalized&&t===this.getEOL()&&this._EOLNormalized?r:r.replace(/\r\n|\r|\n/g,t):r}getValueInRange2(e,t){if(e.node===t.node){let n=e.node,i=this._buffers[n.piece.bufferIndex].buffer,r=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return i.substring(r+e.remainder,r+t.remainder)}let n=e.node,i=this._buffers[n.piece.bufferIndex].buffer,r=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start),s=i.substring(r+e.remainder,r+n.piece.length);for(n=n.next();n!==V;){let e=this._buffers[n.piece.bufferIndex].buffer,i=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(n===t.node){s+=e.substring(i,i+t.remainder);break}s+=e.substr(i,n.piece.length),n=n.next()}return s}getLinesContent(){let e=[],t=0,n="",i=!1;return this.iterate(this.root,(r=>{if(r===V)return!0;const s=r.piece;let o=s.length;if(0===o)return!0;const a=this._buffers[s.bufferIndex].buffer,l=this._buffers[s.bufferIndex].lineStarts,h=s.start.line,u=s.end.line;let c=l[h]+s.start.column;if(i&&(10===a.charCodeAt(c)&&(c++,o--),e[t++]=n,n="",i=!1,0===o))return!0;if(h===u)return this._EOLNormalized||13!==a.charCodeAt(c+o-1)?n+=a.substr(c,o):(i=!0,n+=a.substr(c,o-1)),!0;n+=this._EOLNormalized?a.substring(c,Math.max(c,l[h+1]-this._EOLLength)):a.substring(c,l[h+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=n;for(let i=h+1;i<u;i++)n=this._EOLNormalized?a.substring(l[i],l[i+1]-this._EOLLength):a.substring(l[i],l[i+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=n;return this._EOLNormalized||13!==a.charCodeAt(l[u]+s.end.column-1)?n=a.substr(l[u],s.end.column):(i=!0,0===s.end.column?t--:n=a.substr(l[u],s.end.column-1)),!0})),i&&(e[t++]=n,n=""),e[t++]=n,e}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(e){return this._lastVisitedLine.lineNumber===e||(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,"")),this._lastVisitedLine.value}_getCharCode(e){if(e.remainder===e.node.piece.length){let t=e.node.next();if(!t)return 0;let n=this._buffers[t.piece.bufferIndex],i=this.offsetInBuffer(t.piece.bufferIndex,t.piece.start);return n.buffer.charCodeAt(i)}{let t=this._buffers[e.node.piece.bufferIndex],n=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return t.buffer.charCodeAt(n)}}getLineCharCode(e,t){let n=this.nodeAt2(e,t+1);return this._getCharCode(n)}getLineLength(e){if(e===this.getLineCount()){let t=this.getOffsetAt(e,1);return this.getLength()-t}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}findMatchesInNode(e,t,n,i,r,s,o,a,l,h,c){let d,f,g,_=this._buffers[e.piece.bufferIndex],p=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),m=this.offsetInBuffer(e.piece.bufferIndex,r),L=this.offsetInBuffer(e.piece.bufferIndex,s),C={line:0,column:0};t._wordSeparators?(f=_.buffer.substring(m,L),g=e=>e+m,t.reset(0)):(f=_.buffer,g=e=>e,t.reset(m));do{if(d=t.next(f),d){if(g(d.index)>=L)return h;this.positionInBuffer(e,g(d.index)-p,C);let t=this.getLineFeedCnt(e.piece.bufferIndex,r,C),s=C.line===r.line?C.column-r.column+i:C.column+1,o=s+d[0].length;if(c[h++]=(0,K.iE)(new u.e(n+t,s,n+t,o),d,a),g(d.index)+d[0].length>=L)return h;if(h>=l)return h}}while(d);return h}findMatchesLineByLine(e,t,n,i){const r=[];let s=0;const o=new K.sz(t.wordSeparators,t.regex);let a=this.nodeAt2(e.startLineNumber,e.startColumn);if(null===a)return[];let l=this.nodeAt2(e.endLineNumber,e.endColumn);if(null===l)return[];let h=this.positionInBuffer(a.node,a.remainder),u=this.positionInBuffer(l.node,l.remainder);if(a.node===l.node)return this.findMatchesInNode(a.node,o,e.startLineNumber,e.startColumn,h,u,t,n,i,s,r),r;let c=e.startLineNumber,d=a.node;for(;d!==l.node;){let l=this.getLineFeedCnt(d.piece.bufferIndex,h,d.piece.end);if(l>=1){let a=this._buffers[d.piece.bufferIndex].lineStarts,u=this.offsetInBuffer(d.piece.bufferIndex,d.piece.start),f=a[h.line+l],g=c===e.startLineNumber?e.startColumn:1;if(s=this.findMatchesInNode(d,o,c,g,h,this.positionInBuffer(d,f-u),t,n,i,s,r),s>=i)return r;c+=l}let u=c===e.startLineNumber?e.startColumn-1:0;if(c===e.endLineNumber){const a=this.getLineContent(c).substring(u,e.endColumn-1);return s=this._findMatchesInLine(t,o,a,e.endLineNumber,u,s,r,n,i),r}if(s=this._findMatchesInLine(t,o,this.getLineContent(c).substr(u),c,u,s,r,n,i),s>=i)return r;c++,a=this.nodeAt2(c,1),d=a.node,h=this.positionInBuffer(a.node,a.remainder)}if(c===e.endLineNumber){let a=c===e.startLineNumber?e.startColumn-1:0;const l=this.getLineContent(c).substring(a,e.endColumn-1);return s=this._findMatchesInLine(t,o,l,e.endLineNumber,a,s,r,n,i),r}let f=c===e.startLineNumber?e.startColumn:1;return s=this.findMatchesInNode(l.node,o,c,f,h,u,t,n,i,s,r),r}_findMatchesInLine(e,t,n,i,r,s,o,a,l){const h=e.wordSeparators;if(!a&&e.simpleSearch){const t=e.simpleSearch,a=t.length,c=n.length;let f=-a;for(;-1!==(f=n.indexOf(t,f+a));)if((!h||(0,K.cM)(h,n,c,f,a))&&(o[s++]=new d.tk(new u.e(i,f+1+r,i,f+1+a+r),null),s>=l))return s;return s}let c;t.reset(0);do{if(c=t.next(n),c&&(o[s++]=(0,K.iE)(new u.e(i,c.index+1+r,i,c.index+1+c[0].length+r),c,a),s>=l))return s}while(c);return s}insert(e,t,n=!1){if(this._EOLNormalized=this._EOLNormalized&&n,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==V){let{node:n,remainder:i,nodeStartOffset:r}=this.nodeAt(e),s=n.piece,o=s.bufferIndex,a=this.positionInBuffer(n,i);if(0===n.piece.bufferIndex&&s.end.line===this._lastChangeBufferPos.line&&s.end.column===this._lastChangeBufferPos.column&&r+s.length===e&&t.length<X)return this.appendToNode(n,t),void this.computeBufferMetadata();if(r===e)this.insertContentToNodeLeft(t,n),this._searchCache.validate(e);else if(r+n.piece.length>e){let e=[],r=new ie(s.bufferIndex,a,s.end,this.getLineFeedCnt(s.bufferIndex,a,s.end),this.offsetInBuffer(o,s.end)-this.offsetInBuffer(o,a));if(this.shouldCheckCRLF()&&this.endWithCR(t)){if(10===this.nodeCharCodeAt(n,i)){let e={line:r.start.line+1,column:0};r=new ie(r.bufferIndex,e,r.end,this.getLineFeedCnt(r.bufferIndex,e,r.end),r.length-1),t+="\n"}}if(this.shouldCheckCRLF()&&this.startWithLF(t)){if(13===this.nodeCharCodeAt(n,i-1)){let r=this.positionInBuffer(n,i-1);this.deleteNodeTail(n,r),t="\r"+t,0===n.piece.length&&e.push(n)}else this.deleteNodeTail(n,a)}else this.deleteNodeTail(n,a);let l=this.createNewPieces(t);r.length>0&&this.rbInsertRight(n,r);let h=n;for(let e=0;e<l.length;e++)h=this.rbInsertRight(h,l[e]);this.deleteNodes(e)}else this.insertContentToNodeRight(t,n)}else{let e=this.createNewPieces(t),n=this.rbInsertLeft(null,e[0]);for(let t=1;t<e.length;t++)n=this.rbInsertRight(n,e[t])}this.computeBufferMetadata()}delete(e,t){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",t<=0||this.root===V)return;let n=this.nodeAt(e),i=this.nodeAt(e+t),r=n.node,s=i.node;if(r===s){let s=this.positionInBuffer(r,n.remainder),o=this.positionInBuffer(r,i.remainder);if(n.nodeStartOffset===e){if(t===r.piece.length){let e=r.next();return Z(this,r),this.validateCRLFWithPrevNode(e),void this.computeBufferMetadata()}return this.deleteNodeHead(r,o),this._searchCache.validate(e),this.validateCRLFWithPrevNode(r),void this.computeBufferMetadata()}return n.nodeStartOffset+r.piece.length===e+t?(this.deleteNodeTail(r,s),this.validateCRLFWithNextNode(r),void this.computeBufferMetadata()):(this.shrinkNode(r,s,o),void this.computeBufferMetadata())}let o=[],a=this.positionInBuffer(r,n.remainder);this.deleteNodeTail(r,a),this._searchCache.validate(e),0===r.piece.length&&o.push(r);let l=this.positionInBuffer(s,i.remainder);this.deleteNodeHead(s,l),0===s.piece.length&&o.push(s);for(let e=r.next();e!==V&&e!==s;e=e.next())o.push(e);let h=0===r.piece.length?r.prev():r;this.deleteNodes(o),this.validateCRLFWithNextNode(h),this.computeBufferMetadata()}insertContentToNodeLeft(e,t){let n=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(t)){let i=t.piece,r={line:i.start.line+1,column:0},s=new ie(i.bufferIndex,r,i.end,this.getLineFeedCnt(i.bufferIndex,r,i.end),i.length-1);t.piece=s,e+="\n",J(this,t,-1,-1),0===t.piece.length&&n.push(t)}let i=this.createNewPieces(e),r=this.rbInsertLeft(t,i[i.length-1]);for(let e=i.length-2;e>=0;e--)r=this.rbInsertLeft(r,i[e]);this.validateCRLFWithPrevNode(r),this.deleteNodes(n)}insertContentToNodeRight(e,t){this.adjustCarriageReturnFromNext(e,t)&&(e+="\n");let n=this.createNewPieces(e),i=this.rbInsertRight(t,n[0]),r=i;for(let e=1;e<n.length;e++)r=this.rbInsertRight(r,n[e]);this.validateCRLFWithPrevNode(i)}positionInBuffer(e,t,n){let i=e.piece,r=e.piece.bufferIndex,s=this._buffers[r].lineStarts,o=s[i.start.line]+i.start.column+t,a=i.start.line,l=i.end.line,h=0,u=0,c=0;for(;a<=l&&(h=a+(l-a)/2|0,c=s[h],h!==l);)if(u=s[h+1],o<c)l=h-1;else{if(!(o>=u))break;a=h+1}return n?(n.line=h,n.column=o-c,null):{line:h,column:o-c}}getLineFeedCnt(e,t,n){if(0===n.column)return n.line-t.line;let i=this._buffers[e].lineStarts;if(n.line===i.length-1)return n.line-t.line;let r=i[n.line+1],s=i[n.line]+n.column;if(r>s+1)return n.line-t.line;let o=s-1;return 13===this._buffers[e].buffer.charCodeAt(o)?n.line-t.line+1:n.line-t.line}offsetInBuffer(e,t){return this._buffers[e].lineStarts[t.line]+t.column}deleteNodes(e){for(let t=0;t<e.length;t++)Z(this,e[t])}createNewPieces(e){if(e.length>X){let t=[];for(;e.length>X;){const n=e.charCodeAt(65534);let i;13===n||n>=55296&&n<=56319?(i=e.substring(0,65534),e=e.substring(65534)):(i=e.substring(0,X),e=e.substring(X));let r=ne(i);t.push(new ie(this._buffers.length,{line:0,column:0},{line:r.length-1,column:i.length-r[r.length-1]},r.length-1,i.length)),this._buffers.push(new re(i,r))}let n=ne(e);return t.push(new ie(this._buffers.length,{line:0,column:0},{line:n.length-1,column:e.length-n[n.length-1]},n.length-1,e.length)),this._buffers.push(new re(e,n)),t}let t=this._buffers[0].buffer.length;const n=ne(e,!1);let i=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===t&&0!==t&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},i=this._lastChangeBufferPos;for(let e=0;e<n.length;e++)n[e]+=t+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+="_"+e,t+=1}else{if(0!==t)for(let e=0;e<n.length;e++)n[e]+=t;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+=e}const r=this._buffers[0].buffer.length;let s=this._buffers[0].lineStarts.length-1,o={line:s,column:r-this._buffers[0].lineStarts[s]},a=new ie(0,i,o,this.getLineFeedCnt(0,i,o),r-t);return this._lastChangeBufferPos=o,[a]}getLineRawContent(e,t=0){let n=this.root,i="",r=this._searchCache.get2(e);if(r){n=r.node;let s=this.getAccumulatedValue(n,e-r.nodeStartLineNumber-1),o=this._buffers[n.piece.bufferIndex].buffer,a=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(r.nodeStartLineNumber+n.piece.lineFeedCnt!==e){let i=this.getAccumulatedValue(n,e-r.nodeStartLineNumber);return o.substring(a+s,a+i-t)}i=o.substring(a+s,a+n.piece.length)}else{let r=0;const s=e;for(;n!==V;)if(n.left!==V&&n.lf_left>=e-1)n=n.left;else{if(n.lf_left+n.piece.lineFeedCnt>e-1){let i=this.getAccumulatedValue(n,e-n.lf_left-2),o=this.getAccumulatedValue(n,e-n.lf_left-1),a=this._buffers[n.piece.bufferIndex].buffer,l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return r+=n.size_left,this._searchCache.set({node:n,nodeStartOffset:r,nodeStartLineNumber:s-(e-1-n.lf_left)}),a.substring(l+i,l+o-t)}if(n.lf_left+n.piece.lineFeedCnt===e-1){let t=this.getAccumulatedValue(n,e-n.lf_left-2),r=this._buffers[n.piece.bufferIndex].buffer,s=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i=r.substring(s+t,s+n.piece.length);break}e-=n.lf_left+n.piece.lineFeedCnt,r+=n.size_left+n.piece.length,n=n.right}}for(n=n.next();n!==V;){let e=this._buffers[n.piece.bufferIndex].buffer;if(n.piece.lineFeedCnt>0){let r=this.getAccumulatedValue(n,0),s=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return i+=e.substring(s,s+r-t),i}{let t=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i+=e.substr(t,n.piece.length)}n=n.next()}return i}computeBufferMetadata(){let e=this.root,t=1,n=0;for(;e!==V;)t+=e.lf_left+e.piece.lineFeedCnt,n+=e.size_left+e.piece.length,e=e.right;this._lineCnt=t,this._length=n,this._searchCache.validate(this._length)}getIndexOf(e,t){let n=e.piece,i=this.positionInBuffer(e,t),r=i.line-n.start.line;if(this.offsetInBuffer(n.bufferIndex,n.end)-this.offsetInBuffer(n.bufferIndex,n.start)===t){let t=this.getLineFeedCnt(e.piece.bufferIndex,n.start,i);if(t!==r)return{index:t,remainder:0}}return{index:r,remainder:i.column}}getAccumulatedValue(e,t){if(t<0)return 0;let n=e.piece,i=this._buffers[n.bufferIndex].lineStarts,r=n.start.line+t+1;return r>n.end.line?i[n.end.line]+n.end.column-i[n.start.line]-n.start.column:i[r]-i[n.start.line]-n.start.column}deleteNodeTail(e,t){const n=e.piece,i=n.lineFeedCnt,r=this.offsetInBuffer(n.bufferIndex,n.end),s=t,o=this.offsetInBuffer(n.bufferIndex,s),a=this.getLineFeedCnt(n.bufferIndex,n.start,s),l=a-i,h=o-r,u=n.length+h;e.piece=new ie(n.bufferIndex,n.start,s,a,u),J(this,e,h,l)}deleteNodeHead(e,t){const n=e.piece,i=n.lineFeedCnt,r=this.offsetInBuffer(n.bufferIndex,n.start),s=t,o=this.getLineFeedCnt(n.bufferIndex,s,n.end),a=o-i,l=r-this.offsetInBuffer(n.bufferIndex,s),h=n.length+l;e.piece=new ie(n.bufferIndex,s,n.end,o,h),J(this,e,l,a)}shrinkNode(e,t,n){const i=e.piece,r=i.start,s=i.end,o=i.length,a=i.lineFeedCnt,l=t,h=this.getLineFeedCnt(i.bufferIndex,i.start,l),u=this.offsetInBuffer(i.bufferIndex,t)-this.offsetInBuffer(i.bufferIndex,r);e.piece=new ie(i.bufferIndex,i.start,l,h,u),J(this,e,u-o,h-a);let c=new ie(i.bufferIndex,n,s,this.getLineFeedCnt(i.bufferIndex,n,s),this.offsetInBuffer(i.bufferIndex,s)-this.offsetInBuffer(i.bufferIndex,n)),d=this.rbInsertRight(e,c);this.validateCRLFWithPrevNode(d)}appendToNode(e,t){this.adjustCarriageReturnFromNext(t,e)&&(t+="\n");const n=this.shouldCheckCRLF()&&this.startWithLF(t)&&this.endWithCR(e),i=this._buffers[0].buffer.length;this._buffers[0].buffer+=t;const r=ne(t,!1);for(let e=0;e<r.length;e++)r[e]+=i;if(n){let e=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:i-e}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(r.slice(1));const s=this._buffers[0].lineStarts.length-1,o={line:s,column:this._buffers[0].buffer.length-this._buffers[0].lineStarts[s]},a=e.piece.length+t.length,l=e.piece.lineFeedCnt,h=this.getLineFeedCnt(0,e.piece.start,o),u=h-l;e.piece=new ie(e.piece.bufferIndex,e.piece.start,o,h,a),this._lastChangeBufferPos=o,J(this,e,t.length,u)}nodeAt(e){let t=this.root,n=this._searchCache.get(e);if(n)return{node:n.node,nodeStartOffset:n.nodeStartOffset,remainder:e-n.nodeStartOffset};let i=0;for(;t!==V;)if(t.size_left>e)t=t.left;else{if(t.size_left+t.piece.length>=e){i+=t.size_left;let n={node:t,remainder:e-t.size_left,nodeStartOffset:i};return this._searchCache.set(n),n}e-=t.size_left+t.piece.length,i+=t.size_left+t.piece.length,t=t.right}return null}nodeAt2(e,t){let n=this.root,i=0;for(;n!==V;)if(n.left!==V&&n.lf_left>=e-1)n=n.left;else{if(n.lf_left+n.piece.lineFeedCnt>e-1){let r=this.getAccumulatedValue(n,e-n.lf_left-2),s=this.getAccumulatedValue(n,e-n.lf_left-1);return i+=n.size_left,{node:n,remainder:Math.min(r+t-1,s),nodeStartOffset:i}}if(n.lf_left+n.piece.lineFeedCnt===e-1){let r=this.getAccumulatedValue(n,e-n.lf_left-2);if(r+t-1<=n.piece.length)return{node:n,remainder:r+t-1,nodeStartOffset:i};t-=n.piece.length-r;break}e-=n.lf_left+n.piece.lineFeedCnt,i+=n.size_left+n.piece.length,n=n.right}for(n=n.next();n!==V;){if(n.piece.lineFeedCnt>0){let e=this.getAccumulatedValue(n,0),i=this.offsetOfNode(n);return{node:n,remainder:Math.min(t-1,e),nodeStartOffset:i}}if(n.piece.length>=t-1){return{node:n,remainder:t-1,nodeStartOffset:this.offsetOfNode(n)}}t-=n.piece.length,n=n.next()}return null}nodeCharCodeAt(e,t){if(e.piece.lineFeedCnt<1)return-1;let n=this._buffers[e.piece.bufferIndex],i=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+t;return n.buffer.charCodeAt(i)}offsetOfNode(e){if(!e)return 0;let t=e.size_left;for(;e!==this.root;)e.parent.right===e&&(t+=e.parent.size_left+e.parent.piece.length),e=e.parent;return t}shouldCheckCRLF(){return!(this._EOLNormalized&&"\n"===this._EOL)}startWithLF(e){if("string"==typeof e)return 10===e.charCodeAt(0);if(e===V||0===e.piece.lineFeedCnt)return!1;let t=e.piece,n=this._buffers[t.bufferIndex].lineStarts,i=t.start.line,r=n[i]+t.start.column;return i!==n.length-1&&(!(n[i+1]>r+1)&&10===this._buffers[t.bufferIndex].buffer.charCodeAt(r))}endWithCR(e){return"string"==typeof e?13===e.charCodeAt(e.length-1):e!==V&&0!==e.piece.lineFeedCnt&&13===this.nodeCharCodeAt(e,e.piece.length-1)}validateCRLFWithPrevNode(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){let t=e.prev();this.endWithCR(t)&&this.fixCRLF(t,e)}}validateCRLFWithNextNode(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){let t=e.next();this.startWithLF(t)&&this.fixCRLF(e,t)}}fixCRLF(e,t){let n,i=[],r=this._buffers[e.piece.bufferIndex].lineStarts;n=0===e.piece.end.column?{line:e.piece.end.line-1,column:r[e.piece.end.line]-r[e.piece.end.line-1]-1}:{line:e.piece.end.line,column:e.piece.end.column-1};const s=e.piece.length-1,o=e.piece.lineFeedCnt-1;e.piece=new ie(e.piece.bufferIndex,e.piece.start,n,o,s),J(this,e,-1,-1),0===e.piece.length&&i.push(e);let a={line:t.piece.start.line+1,column:0};const l=t.piece.length-1,h=this.getLineFeedCnt(t.piece.bufferIndex,a,t.piece.end);t.piece=new ie(t.piece.bufferIndex,a,t.piece.end,h,l),J(this,t,-1,-1),0===t.piece.length&&i.push(t);let u=this.createNewPieces("\r\n");this.rbInsertRight(e,u[0]);for(let e=0;e<i.length;e++)Z(this,i[e])}adjustCarriageReturnFromNext(e,t){if(this.shouldCheckCRLF()&&this.endWithCR(e)){let n=t.next();if(this.startWithLF(n)){if(e+="\n",1===n.piece.length)Z(this,n);else{const e=n.piece,t={line:e.start.line+1,column:0},i=e.length-1,r=this.getLineFeedCnt(e.bufferIndex,t,e.end);n.piece=new ie(e.bufferIndex,t,e.end,r,i),J(this,n,-1,-1)}return!0}}return!1}iterate(e,t){if(e===V)return t(V);let n=this.iterate(e.left,t);return n?t(e)&&this.iterate(e.right,t):n}getNodeContent(e){if(e===V)return"";let t,n=this._buffers[e.piece.bufferIndex],i=e.piece,r=this.offsetInBuffer(i.bufferIndex,i.start),s=this.offsetInBuffer(i.bufferIndex,i.end);return t=n.buffer.substring(r,s),t}getPieceContent(e){let t=this._buffers[e.bufferIndex],n=this.offsetInBuffer(e.bufferIndex,e.start),i=this.offsetInBuffer(e.bufferIndex,e.end);return t.buffer.substring(n,i)}rbInsertRight(e,t){let n=new F(t,1);if(n.left=V,n.right=V,n.parent=V,n.size_left=0,n.lf_left=0,this.root===V)this.root=n,n.color=0;else if(e.right===V)e.right=n,n.parent=e;else{let t=W(e.right);t.left=n,n.parent=t}return G(this,n),n}rbInsertLeft(e,t){let n=new F(t,1);if(n.left=V,n.right=V,n.parent=V,n.size_left=0,n.lf_left=0,this.root===V)this.root=n,n.color=0;else if(e.left===V)e.left=n,n.parent=e;else{let t=U(e.left);t.right=n,n.parent=t}return G(this,n),n}}var le=n(58409),he=n(60962);class ue extends s.JT{constructor(e,t,n,i,s,o,a){super(),this._onDidChangeContent=this._register(new r.Q5),this._BOM=t,this._mightContainNonBasicASCII=!o,this._mightContainRTL=i,this._mightContainUnusualLineTerminators=s,this._pieceTree=new ae(e,n,a)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(e){return this._pieceTree.createSnapshot(e?this._BOM:"")}getOffsetAt(e,t){return this._pieceTree.getOffsetAt(e,t)}getPositionAt(e){return this._pieceTree.getPositionAt(e)}getRangeAt(e,t){let n=e+t;const i=this.getPositionAt(e),r=this.getPositionAt(n);return new u.e(i.lineNumber,i.column,r.lineNumber,r.column)}getValueInRange(e,t=0){if(e.isEmpty())return"";const n=this._getEndOfLine(t);return this._pieceTree.getValueInRange(e,n)}getValueLengthInRange(e,t=0){if(e.isEmpty())return 0;if(e.startLineNumber===e.endLineNumber)return e.endColumn-e.startColumn;let n=this.getOffsetAt(e.startLineNumber,e.startColumn);return this.getOffsetAt(e.endLineNumber,e.endColumn)-n}getCharacterCountInRange(e,t=0){if(this._mightContainNonBasicASCII){let n=0;const i=e.startLineNumber,r=e.endLineNumber;for(let t=i;t<=r;t++){const s=this.getLineContent(t),a=t===i?e.startColumn-1:0,l=t===r?e.endColumn-1:s.length;for(let e=a;e<l;e++)o.ZG(s.charCodeAt(e))?(n+=1,e+=1):n+=1}return n+=this._getEndOfLine(t).length*(r-i),n}return this.getValueLengthInRange(e,t)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(e){return this._pieceTree.getLineContent(e)}getLineCharCode(e,t){return this._pieceTree.getLineCharCode(e,t)}getLineLength(e){return this._pieceTree.getLineLength(e)}getLineFirstNonWhitespaceColumn(e){const t=o.LC(this.getLineContent(e));return-1===t?0:t+1}getLineLastNonWhitespaceColumn(e){const t=o.ow(this.getLineContent(e));return-1===t?0:t+2}_getEndOfLine(e){switch(e){case 1:return"\n";case 2:return"\r\n";case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(e){this._pieceTree.setEOL(e)}applyEdits(e,t,n){let i=this._mightContainRTL,r=this._mightContainUnusualLineTerminators,s=this._mightContainNonBasicASCII,a=!0,l=[];for(let t=0;t<e.length;t++){let n=e[t];a&&n._isTracked&&(a=!1);let h=n.range;if(n.text){let e=!0;s||(e=!o.$i(n.text),s=e),!i&&e&&(i=o.Ut(n.text)),!r&&e&&(r=o.ab(n.text))}let u="",c=0,d=0,f=0;if(n.text){let e;[c,d,f,e]=(0,le.QZ)(n.text);const t=this.getEOL(),i="\r\n"===t?2:1;u=0===e||e===i?n.text:n.text.replace(/\r\n|\r|\n/g,t)}l[t]={sortIndex:t,identifier:n.identifier||null,range:h,rangeOffset:this.getOffsetAt(h.startLineNumber,h.startColumn),rangeLength:this.getValueLengthInRange(h),text:u,eolCount:c,firstLineLength:d,lastLineLength:f,forceMoveMarkers:Boolean(n.forceMoveMarkers),isAutoWhitespaceEdit:n.isAutoWhitespaceEdit||!1}}l.sort(ue._sortOpsAscending);let h=!1;for(let e=0,t=l.length-1;e<t;e++){let t=l[e].range.getEndPosition(),n=l[e+1].range.getStartPosition();if(n.isBeforeOrEqual(t)){if(n.isBefore(t))throw new Error("Overlapping ranges are not allowed!");h=!0}}a&&(l=this._reduceOperations(l));let u=n||t?ue._getInverseEditRanges(l):[],c=[];if(t)for(let e=0;e<l.length;e++){let t=l[e],n=u[e];if(t.isAutoWhitespaceEdit&&t.range.isEmpty())for(let e=n.startLineNumber;e<=n.endLineNumber;e++){let i="";e===n.startLineNumber&&(i=this.getLineContent(t.range.startLineNumber),-1!==o.LC(i))||c.push({lineNumber:e,oldContent:i})}}let f=null;if(n){let e=0;f=[];for(let t=0;t<l.length;t++){const n=l[t],i=u[t],r=this.getValueInRange(n.range),s=n.rangeOffset+e;e+=n.text.length-r.length,f[t]={sortIndex:n.sortIndex,identifier:n.identifier,range:i,text:r,textChange:new he.q(n.rangeOffset,r,s,n.text)}}h||f.sort(((e,t)=>e.sortIndex-t.sortIndex))}this._mightContainRTL=i,this._mightContainUnusualLineTerminators=r,this._mightContainNonBasicASCII=s;const g=this._doApplyEdits(l);let _=null;if(t&&c.length>0){c.sort(((e,t)=>t.lineNumber-e.lineNumber)),_=[];for(let e=0,t=c.length;e<t;e++){let t=c[e].lineNumber;if(e>0&&c[e-1].lineNumber===t)continue;let n=c[e].oldContent,i=this.getLineContent(t);0!==i.length&&i!==n&&-1===o.LC(i)&&_.push(t)}}return this._onDidChangeContent.fire(),new d.je(f,g,_)}_reduceOperations(e){return e.length<1e3?e:[this._toSingleEditOperation(e)]}_toSingleEditOperation(e){let t=!1;const n=e[0].range,i=e[e.length-1].range,r=new u.e(n.startLineNumber,n.startColumn,i.endLineNumber,i.endColumn);let s=n.startLineNumber,o=n.startColumn;const a=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=i.range;t=t||i.forceMoveMarkers,a.push(this.getValueInRange(new u.e(s,o,r.startLineNumber,r.startColumn))),i.text.length>0&&a.push(i.text),s=r.endLineNumber,o=r.endColumn}const l=a.join(""),[h,c,d]=(0,le.QZ)(l);return{sortIndex:0,identifier:e[0].identifier,range:r,rangeOffset:this.getOffsetAt(r.startLineNumber,r.startColumn),rangeLength:this.getValueLengthInRange(r,0),text:l,eolCount:h,firstLineLength:c,lastLineLength:d,forceMoveMarkers:t,isAutoWhitespaceEdit:!1}}_doApplyEdits(e){e.sort(ue._sortOpsDescending);let t=[];for(let n=0;n<e.length;n++){let i=e[n];const r=i.range.startLineNumber,s=i.range.startColumn,o=i.range.endLineNumber,a=i.range.endColumn;if(r===o&&s===a&&0===i.text.length)continue;i.text?(this._pieceTree.delete(i.rangeOffset,i.rangeLength),this._pieceTree.insert(i.rangeOffset,i.text,!0)):this._pieceTree.delete(i.rangeOffset,i.rangeLength);const l=new u.e(r,s,o,a);t.push({range:l,rangeLength:i.rangeLength,text:i.text,rangeOffset:i.rangeOffset,forceMoveMarkers:i.forceMoveMarkers})}return t}findMatchesLineByLine(e,t,n,i){return this._pieceTree.findMatchesLineByLine(e,t,n,i)}static _getInverseEditRanges(e){let t=[],n=0,i=0,r=null;for(let s=0,o=e.length;s<o;s++){let o,a,l,h=e[s];if(r?r.range.endLineNumber===h.range.startLineNumber?(o=n,a=i+(h.range.startColumn-r.range.endColumn)):(o=n+(h.range.startLineNumber-r.range.endLineNumber),a=h.range.startColumn):(o=h.range.startLineNumber,a=h.range.startColumn),h.text.length>0){const e=h.eolCount+1;l=1===e?new u.e(o,a,o,a+h.firstLineLength):new u.e(o,a,o+e-1,h.lastLineLength+1)}else l=new u.e(o,a,o,a);n=l.endLineNumber,i=l.endColumn,t.push(l),r=h}return t}static _sortOpsAscending(e,t){let n=u.e.compareRangesUsingEnds(e.range,t.range);return 0===n?e.sortIndex-t.sortIndex:n}static _sortOpsDescending(e,t){let n=u.e.compareRangesUsingEnds(e.range,t.range);return 0===n?t.sortIndex-e.sortIndex:-n}}class ce{constructor(e,t,n,i,r,s,o,a,l){this._chunks=e,this._bom=t,this._cr=n,this._lf=i,this._crlf=r,this._containsRTL=s,this._containsUnusualLineTerminators=o,this._isBasicASCII=a,this._normalizeEOL=l}_getEOL(e){const t=this._cr+this._lf+this._crlf,n=this._cr+this._crlf;return 0===t?1===e?"\n":"\r\n":n>t/2?"\r\n":"\n"}create(e){const t=this._getEOL(e);let n=this._chunks;if(this._normalizeEOL&&("\r\n"===t&&(this._cr>0||this._lf>0)||"\n"===t&&(this._cr>0||this._crlf>0)))for(let e=0,i=n.length;e<i;e++){let i=n[e].buffer.replace(/\r\n|\r|\n/g,t),r=ne(i);n[e]=new re(i,r)}const i=new ue(n,this._bom,t,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:i,disposable:i}}}class de{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(e){if(0===e.length)return;0===this.chunks.length&&o.uS(e)&&(this.BOM=o.c1,e=e.substr(1));const t=e.charCodeAt(e.length-1);13===t||t>=55296&&t<=56319?(this._acceptChunk1(e.substr(0,e.length-1),!1),this._hasPreviousChar=!0,this._previousChar=t):(this._acceptChunk1(e,!1),this._hasPreviousChar=!1,this._previousChar=t)}_acceptChunk1(e,t){(t||0!==e.length)&&(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+e):this._acceptChunk2(e))}_acceptChunk2(e){const t=function(e,t){e.length=0,e[0]=0;let n=1,i=0,r=0,s=0,o=!0;for(let a=0,l=t.length;a<l;a++){const h=t.charCodeAt(a);13===h?a+1<l&&10===t.charCodeAt(a+1)?(s++,e[n++]=a+2,a++):(i++,e[n++]=a+1):10===h?(r++,e[n++]=a+1):o&&9!==h&&(h<32||h>126)&&(o=!1)}const a=new te(ee(e),i,r,s,o);return e.length=0,a}(this._tmpLineStarts,e);this.chunks.push(new re(e,t.lineStarts)),this.cr+=t.cr,this.lf+=t.lf,this.crlf+=t.crlf,this.isBasicASCII&&(this.isBasicASCII=t.isBasicASCII),this.isBasicASCII||this.containsRTL||(this.containsRTL=o.Ut(e)),this.isBasicASCII||this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=o.ab(e))}finish(e=!0){return this._finish(),new ce(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,e)}_finish(){if(0===this.chunks.length&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;let e=this.chunks[this.chunks.length-1];e.buffer+=String.fromCharCode(this._previousChar);let t=ne(e.buffer);e.lineStarts=t,13===this._previousChar&&this.cr++}}}var fe=n(83256),ge=n(9488),_e=n(78411),pe=n(44101),me=n(28111),Le=n(84013),Ce=n(1432);class be{constructor(){this._beginState=[],this._valid=[],this._len=0,this._invalidLineStartIndex=0}_reset(e){this._beginState=[],this._valid=[],this._len=0,this._invalidLineStartIndex=0,e&&this._setBeginState(0,e)}flush(e){this._reset(e)}get invalidLineStartIndex(){return this._invalidLineStartIndex}_invalidateLine(e){e<this._len&&(this._valid[e]=!1),e<this._invalidLineStartIndex&&(this._invalidLineStartIndex=e)}_isValid(e){return e<this._len&&this._valid[e]}getBeginState(e){return e<this._len?this._beginState[e]:null}_ensureLine(e){for(;e>=this._len;)this._beginState[this._len]=null,this._valid[this._len]=!1,this._len++}_deleteLines(e,t){0!==t&&(e+t>this._len&&(t=this._len-e),this._beginState.splice(e,t),this._valid.splice(e,t),this._len-=t)}_insertLines(e,t){if(0===t)return;let n=[],i=[];for(let e=0;e<t;e++)n[e]=null,i[e]=!1;this._beginState=ge.Zv(this._beginState,e,n),this._valid=ge.Zv(this._valid,e,i),this._len+=t}_setValid(e,t){this._ensureLine(e),this._valid[e]=t}_setBeginState(e,t){this._ensureLine(e),this._beginState[e]=t}setEndState(e,t,n){if(this._setValid(t,!0),this._invalidLineStartIndex=t+1,t===e-1)return;const i=this.getBeginState(t+1);if(null===i||!n.equals(i))return this._setBeginState(t+1,n),void this._invalidateLine(t+1);let r=t+1;for(;r<e&&this._isValid(r);)r++;this._invalidLineStartIndex=r}setFakeTokens(e){this._setValid(e,!1)}applyEdits(e,t){const n=e.endLineNumber-e.startLineNumber,i=t;for(let t=Math.min(n,i);t>=0;t--)this._invalidateLine(e.startLineNumber+t-1);this._acceptDeleteRange(e),this._acceptInsertText(new h.L(e.startLineNumber,e.startColumn),t)}_acceptDeleteRange(e){e.startLineNumber-1>=this._len||this._deleteLines(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t){e.lineNumber-1>=this._len||this._insertLines(e.lineNumber,t)}}class Ne extends s.JT{constructor(e){super(),this._isDisposed=!1,this._textModel=e,this._tokenizationStateStore=new be,this._tokenizationSupport=null,this._register(pe.RW.onDidChange((e=>{const t=this._textModel.getLanguageIdentifier();-1!==e.changedLanguages.indexOf(t.language)&&(this._resetTokenizationState(),this._textModel.clearTokens())}))),this._register(this._textModel.onDidChangeContentFast((e=>{if(e.isFlush)this._resetTokenizationState();else{for(let t=0,n=e.changes.length;t<n;t++){const n=e.changes[t],[i]=(0,le.QZ)(n.text);this._tokenizationStateStore.applyEdits(n.range,i)}this._beginBackgroundTokenization()}}))),this._register(this._textModel.onDidChangeAttached((()=>{this._beginBackgroundTokenization()}))),this._register(this._textModel.onDidChangeLanguage((()=>{this._resetTokenizationState(),this._textModel.clearTokens()}))),this._resetTokenizationState()}dispose(){this._isDisposed=!0,super.dispose()}_resetTokenizationState(){const[e,t]=function(e){const t=e.getLanguageIdentifier();let n=e.isTooLargeForTokenization()?null:pe.RW.get(t.language),r=null;if(n)try{r=n.getInitialState()}catch(e){(0,i.dL)(e),n=null}return[n,r]}(this._textModel);this._tokenizationSupport=e,this._tokenizationStateStore.flush(t),this._beginBackgroundTokenization()}_beginBackgroundTokenization(){this._textModel.isAttachedToEditor()&&this._hasLinesToTokenize()&&Ce.xS((()=>{this._isDisposed||this._revalidateTokensNow()}))}_revalidateTokensNow(e=this._textModel.getLineCount()){const t=new le.DA,n=Le.G.create(!1);for(;this._hasLinesToTokenize()&&!(n.elapsed()>1);){if(this._tokenizeOneInvalidLine(t)>=e)break}this._beginBackgroundTokenization(),this._textModel.setTokens(t.tokens)}tokenizeViewport(e,t){const n=new le.DA;this._tokenizeViewport(n,e,t),this._textModel.setTokens(n.tokens)}reset(){this._resetTokenizationState(),this._textModel.clearTokens()}forceTokenization(e){const t=new le.DA;this._updateTokensUntilLine(t,e),this._textModel.setTokens(t.tokens)}isCheapToTokenize(e){if(!this._tokenizationSupport)return!0;const t=this._tokenizationStateStore.invalidLineStartIndex+1;return!(e>t)&&(e<t||this._textModel.getLineLength(e)<2048)}_hasLinesToTokenize(){return!!this._tokenizationSupport&&this._tokenizationStateStore.invalidLineStartIndex<this._textModel.getLineCount()}_tokenizeOneInvalidLine(e){if(!this._hasLinesToTokenize())return this._textModel.getLineCount()+1;const t=this._tokenizationStateStore.invalidLineStartIndex+1;return this._updateTokensUntilLine(e,t),t}_updateTokensUntilLine(e,t){if(!this._tokenizationSupport)return;const n=this._textModel.getLanguageIdentifier(),i=this._textModel.getLineCount(),r=t-1;for(let t=this._tokenizationStateStore.invalidLineStartIndex;t<=r;t++){const r=this._textModel.getLineContent(t+1),s=this._tokenizationStateStore.getBeginState(t),o=Ie(n,this._tokenizationSupport,r,!0,s);e.add(t+1,o.tokens),this._tokenizationStateStore.setEndState(i,t,o.endState),t=this._tokenizationStateStore.invalidLineStartIndex-1}}_tokenizeViewport(e,t,n){if(!this._tokenizationSupport)return;if(n<=this._tokenizationStateStore.invalidLineStartIndex)return;if(t<=this._tokenizationStateStore.invalidLineStartIndex)return void this._updateTokensUntilLine(e,n);let i=this._textModel.getLineFirstNonWhitespaceColumn(t),r=[],s=null;for(let e=t-1;i>0&&e>=1;e--){let t=this._textModel.getLineFirstNonWhitespaceColumn(e);if(0!==t&&t<i){if(s=this._tokenizationStateStore.getBeginState(e-1),s)break;r.push(this._textModel.getLineContent(e)),i=t}}s||(s=this._tokenizationSupport.getInitialState());const o=this._textModel.getLanguageIdentifier();let a=s;for(let e=r.length-1;e>=0;e--){a=Ie(o,this._tokenizationSupport,r[e],!1,a).endState}for(let i=t;i<=n;i++){let t=this._textModel.getLineContent(i),n=Ie(o,this._tokenizationSupport,t,!0,a);e.add(i,n.tokens),this._tokenizationStateStore.setFakeTokens(i-1),a=n.endState}}}function Ie(e,t,n,r,s){let o=null;if(t)try{o=t.tokenize2(n,r,s.clone(),0)}catch(e){(0,i.dL)(e)}return o||(o=(0,me.mh)(e.id,n,s,0)),_e.A.convertToEndOffset(o.tokens,n.length),o}var ve=n(97461),Se=n(83831),xe=n(40764),we=n(34227),ke=n(41264);function Te(e){const t=new de;return t.acceptChunk(e),t.finish()}function Ee(e,t){return("string"==typeof e?Te(e):e).create(t)}let De=0;class Ae{constructor(e){this._source=e,this._eos=!1}read(){if(this._eos)return null;let e=[],t=0,n=0;for(;;){let i=this._source.read();if(null===i)return this._eos=!0,0===t?null:e.join("");if(i.length>0&&(e[t++]=i,n+=i.length),n>=65536)return e.join("")}}}const Oe=()=>{throw new Error("Invalid change accessor")};class Re{constructor(){this._searchCanceledBrand=void 0}}function Me(e){return e instanceof Re?null:e}Re.INSTANCE=new Re;class ze extends s.JT{constructor(e,t,n,i=null,s){super(),this._onWillDispose=this._register(new r.Q5),this.onWillDispose=this._onWillDispose.event,this._onDidChangeDecorations=this._register(new $e((e=>this.handleBeforeFireDecorationsChangedEvent(e)))),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._onDidChangeLanguage=this._register(new r.Q5),this.onDidChangeLanguage=this._onDidChangeLanguage.event,this._onDidChangeLanguageConfiguration=this._register(new r.Q5),this.onDidChangeLanguageConfiguration=this._onDidChangeLanguageConfiguration.event,this._onDidChangeTokens=this._register(new r.Q5),this.onDidChangeTokens=this._onDidChangeTokens.event,this._onDidChangeOptions=this._register(new r.Q5),this.onDidChangeOptions=this._onDidChangeOptions.event,this._onDidChangeAttached=this._register(new r.Q5),this.onDidChangeAttached=this._onDidChangeAttached.event,this._onDidChangeContentOrInjectedText=this._register(new r.Q5),this.onDidChangeContentOrInjectedText=this._onDidChangeContentOrInjectedText.event,this._eventEmitter=this._register(new Ze),this._register(this._eventEmitter.fastEvent((e=>{this._onDidChangeContentOrInjectedText.fire(e.rawContentChangedEvent)}))),De++,this.id="$model"+De,this.isForSimpleWidget=t.isForSimpleWidget,this._associatedResource=null==i?a.o.parse("inmemory://model/"+De):i,this._undoRedoService=s,this._attachedEditorCount=0;const{textBuffer:l,disposable:h}=Ee(e,t.defaultEOL);this._buffer=l,this._bufferDisposable=h,this._options=ze.resolveOptions(this._buffer,t);const c=this._buffer.getLineCount(),d=this._buffer.getValueLengthInRange(new u.e(1,1,c,this._buffer.getLineLength(c)+1),0);t.largeFileOptimizations?this._isTooLargeForTokenization=d>ze.LARGE_FILE_SIZE_THRESHOLD||c>ze.LARGE_FILE_LINE_COUNT_THRESHOLD:this._isTooLargeForTokenization=!1,this._isTooLargeForSyncing=d>ze.MODEL_SYNC_LIMIT,this._versionId=1,this._alternativeVersionId=1,this._initialUndoRedoSnapshot=null,this._isDisposed=!1,this._isDisposing=!1,this._languageIdentifier=n||me.pA,this._languageRegistryListener=Se.zu.onDidChange((e=>{e.languageIdentifier.id===this._languageIdentifier.id&&this._onDidChangeLanguageConfiguration.fire({})})),this._instanceId=o.PJ(De),this._lastDecorationId=0,this._decorations=Object.create(null),this._decorationsTree=new Pe,this._commandManager=new f.NL(this,s),this._isUndoing=!1,this._isRedoing=!1,this._trimAutoWhitespaceLines=null,this._tokens=new le.Rl,this._tokens2=new le.cx,this._tokenization=new Ne(this)}static resolveOptions(e,t){if(t.detectIndentation){const n=p(e,t.tabSize,t.insertSpaces);return new d.dJ({tabSize:n.tabSize,indentSize:n.tabSize,insertSpaces:n.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL})}return new d.dJ({tabSize:t.tabSize,indentSize:t.indentSize,insertSpaces:t.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL})}onDidChangeContentFast(e){return this._eventEmitter.fastEvent((t=>e(t.contentChangedEvent)))}onDidChangeContent(e){return this._eventEmitter.slowEvent((t=>e(t.contentChangedEvent)))}dispose(){this._isDisposing=!0,this._onWillDispose.fire(),this._languageRegistryListener.dispose(),this._tokenization.dispose(),this._isDisposed=!0,super.dispose(),this._bufferDisposable.dispose(),this._isDisposing=!1;const e=new ue([],"","\n",!1,!1,!0,!0);e.dispose(),this._buffer=e}_assertNotDisposed(){if(this._isDisposed)throw new Error("Model is disposed!")}_emitContentChangedEvent(e,t){this._isDisposing||this._eventEmitter.fire(new fe.fV(e,t))}setValue(e){if(this._assertNotDisposed(),null===e)return;const{textBuffer:t,disposable:n}=Ee(e,this._options.defaultEOL);this._setValueFromTextBuffer(t,n)}_createContentChanged2(e,t,n,i,r,s,o){return{changes:[{range:e,rangeOffset:t,rangeLength:n,text:i}],eol:this._buffer.getEOL(),versionId:this.getVersionId(),isUndoing:r,isRedoing:s,isFlush:o}}_setValueFromTextBuffer(e,t){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),s=this.getLineMaxColumn(r);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._tokens.flush(),this._tokens2.flush(),this._decorations=Object.create(null),this._decorationsTree=new Pe,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new fe.dQ([new fe.Jx],this._versionId,!1,!1),this._createContentChanged2(new u.e(1,1,r,s),0,i,this.getValue(),!1,!1,!0))}setEOL(e){this._assertNotDisposed();const t=1===e?"\r\n":"\n";if(this._buffer.getEOL()===t)return;const n=this.getFullModelRange(),i=this.getValueLengthInRange(n),r=this.getLineCount(),s=this.getLineMaxColumn(r);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new fe.dQ([new fe.CZ],this._versionId,!1,!1),this._createContentChanged2(new u.e(1,1,r,s),0,i,this.getValue(),!1,!1,!1))}_onBeforeEOLChange(){this._decorationsTree.ensureAllNodesHaveRanges(this)}_onAfterEOLChange(){const e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder();for(let n=0,i=t.length;n<i;n++){const i=t[n],r=i.range,s=i.cachedAbsoluteStart-i.start,o=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),a=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);i.cachedAbsoluteStart=o,i.cachedAbsoluteEnd=a,i.cachedVersionId=e,i.start=o-s,i.end=a-s,B(i)}}onBeforeAttached(){this._attachedEditorCount++,1===this._attachedEditorCount&&this._onDidChangeAttached.fire(void 0)}onBeforeDetached(){this._attachedEditorCount--,0===this._attachedEditorCount&&this._onDidChangeAttached.fire(void 0)}isAttachedToEditor(){return this._attachedEditorCount>0}getAttachedEditorCount(){return this._attachedEditorCount}isTooLargeForSyncing(){return this._isTooLargeForSyncing}isTooLargeForTokenization(){return this._isTooLargeForTokenization}isDisposed(){return this._isDisposed}isDominatedByLongLines(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;let e=0,t=0;const n=this._buffer.getLineCount();for(let i=1;i<=n;i++){const n=this._buffer.getLineLength(i);n>=1e4?t+=n:e+=n}return t>e}get uri(){return this._associatedResource}getOptions(){return this._assertNotDisposed(),this._options}getFormattingOptions(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}updateOptions(e){this._assertNotDisposed();let t=void 0!==e.tabSize?e.tabSize:this._options.tabSize,n=void 0!==e.indentSize?e.indentSize:this._options.indentSize,i=void 0!==e.insertSpaces?e.insertSpaces:this._options.insertSpaces,r=void 0!==e.trimAutoWhitespace?e.trimAutoWhitespace:this._options.trimAutoWhitespace,s=new d.dJ({tabSize:t,indentSize:n,insertSpaces:i,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:r});if(this._options.equals(s))return;let o=this._options.createChangeEvent(s);this._options=s,this._onDidChangeOptions.fire(o)}detectIndentation(e,t){this._assertNotDisposed();let n=p(this._buffer,t,e);this.updateOptions({insertSpaces:n.insertSpaces,tabSize:n.tabSize,indentSize:n.tabSize})}static _normalizeIndentationFromWhitespace(e,t,n){let i=0;for(let n=0;n<e.length;n++)"\t"===e.charAt(n)?i+=t:i++;let r="";if(!n){let e=Math.floor(i/t);i%=t;for(let t=0;t<e;t++)r+="\t"}for(let e=0;e<i;e++)r+=" ";return r}static normalizeIndentation(e,t,n){let i=o.LC(e);return-1===i&&(i=e.length),ze._normalizeIndentationFromWhitespace(e.substring(0,i),t,n)+e.substring(i)}normalizeIndentation(e){return this._assertNotDisposed(),ze.normalizeIndentation(e,this._options.indentSize,this._options.insertSpaces)}getVersionId(){return this._assertNotDisposed(),this._versionId}mightContainRTL(){return this._buffer.mightContainRTL()}mightContainUnusualLineTerminators(){return this._buffer.mightContainUnusualLineTerminators()}removeUnusualLineTerminators(e=null){const t=this.findMatches(o.Qe.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map((e=>({range:e.range,text:null}))),(()=>null))}mightContainNonBasicASCII(){return this._buffer.mightContainNonBasicASCII()}getAlternativeVersionId(){return this._assertNotDisposed(),this._alternativeVersionId}getInitialUndoRedoSnapshot(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}getOffsetAt(e){this._assertNotDisposed();let t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}getPositionAt(e){this._assertNotDisposed();let t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}_increaseVersionId(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}_overwriteVersionId(e){this._versionId=e}_overwriteAlternativeVersionId(e){this._alternativeVersionId=e}_overwriteInitialUndoRedoSnapshot(e){this._initialUndoRedoSnapshot=e}getValue(e,t=!1){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueInRange(n,e);return t?this._buffer.getBOM()+i:i}createSnapshot(e=!1){return new Ae(this._buffer.createSnapshot(e))}getValueLength(e,t=!1){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueLengthInRange(n,e);return t?this._buffer.getBOM().length+i:i}getValueInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}getValueLengthInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}getCharacterCountInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}getLineCount(){return this._assertNotDisposed(),this._buffer.getLineCount()}getLineContent(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineContent(e)}getLineLength(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLength(e)}getLinesContent(){return this._assertNotDisposed(),this._buffer.getLinesContent()}getEOL(){return this._assertNotDisposed(),this._buffer.getEOL()}getEndOfLineSequence(){return this._assertNotDisposed(),"\n"===this._buffer.getEOL()?0:1}getLineMinColumn(e){return this._assertNotDisposed(),1}getLineMaxColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}getLineFirstNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}getLineLastNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}_validateRangeRelaxedNoAllocations(e){const t=this._buffer.getLineCount(),n=e.startLineNumber,i=e.startColumn;let r=Math.floor("number"!=typeof n||isNaN(n)?1:n),s=Math.floor("number"!=typeof i||isNaN(i)?1:i);if(r<1)r=1,s=1;else if(r>t)r=t,s=this.getLineMaxColumn(r);else if(s<=1)s=1;else{const e=this.getLineMaxColumn(r);s>=e&&(s=e)}const o=e.endLineNumber,a=e.endColumn;let l=Math.floor("number"!=typeof o||isNaN(o)?1:o),h=Math.floor("number"!=typeof a||isNaN(a)?1:a);if(l<1)l=1,h=1;else if(l>t)l=t,h=this.getLineMaxColumn(l);else if(h<=1)h=1;else{const e=this.getLineMaxColumn(l);h>=e&&(h=e)}return n===r&&i===s&&o===l&&a===h&&e instanceof u.e&&!(e instanceof c.Y)?e:new u.e(r,s,l,h)}_isValidPosition(e,t,n){if("number"!=typeof e||"number"!=typeof t)return!1;if(isNaN(e)||isNaN(t))return!1;if(e<1||t<1)return!1;if((0|e)!==e||(0|t)!==t)return!1;if(e>this._buffer.getLineCount())return!1;if(1===t)return!0;if(t>this.getLineMaxColumn(e))return!1;if(1===n){const n=this._buffer.getLineCharCode(e,t-2);if(o.ZG(n))return!1}return!0}_validatePosition(e,t,n){const i=Math.floor("number"!=typeof e||isNaN(e)?1:e),r=Math.floor("number"!=typeof t||isNaN(t)?1:t),s=this._buffer.getLineCount();if(i<1)return new h.L(1,1);if(i>s)return new h.L(s,this.getLineMaxColumn(s));if(r<=1)return new h.L(i,1);const a=this.getLineMaxColumn(i);if(r>=a)return new h.L(i,a);if(1===n){const e=this._buffer.getLineCharCode(i,r-2);if(o.ZG(e))return new h.L(i,r-1)}return new h.L(i,r)}validatePosition(e){return this._assertNotDisposed(),e instanceof h.L&&this._isValidPosition(e.lineNumber,e.column,1)?e:this._validatePosition(e.lineNumber,e.column,1)}_isValidRange(e,t){const n=e.startLineNumber,i=e.startColumn,r=e.endLineNumber,s=e.endColumn;if(!this._isValidPosition(n,i,0))return!1;if(!this._isValidPosition(r,s,0))return!1;if(1===t){const e=i>1?this._buffer.getLineCharCode(n,i-2):0,t=s>1&&s<=this._buffer.getLineLength(r)?this._buffer.getLineCharCode(r,s-2):0,a=o.ZG(e),l=o.ZG(t);return!a&&!l}return!0}validateRange(e){if(this._assertNotDisposed(),e instanceof u.e&&!(e instanceof c.Y)&&this._isValidRange(e,1))return e;const t=this._validatePosition(e.startLineNumber,e.startColumn,0),n=this._validatePosition(e.endLineNumber,e.endColumn,0),i=t.lineNumber,r=t.column,s=n.lineNumber,a=n.column;{const e=r>1?this._buffer.getLineCharCode(i,r-2):0,t=a>1&&a<=this._buffer.getLineLength(s)?this._buffer.getLineCharCode(s,a-2):0,n=o.ZG(e),l=o.ZG(t);return n||l?i===s&&r===a?new u.e(i,r-1,s,a-1):n&&l?new u.e(i,r-1,s,a+1):n?new u.e(i,r-1,s,a):new u.e(i,r,s,a+1):new u.e(i,r,s,a)}}modifyPosition(e,t){this._assertNotDisposed();let n=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,n)))}getFullModelRange(){this._assertNotDisposed();const e=this.getLineCount();return new u.e(1,1,e,this.getLineMaxColumn(e))}findMatchesLineByLine(e,t,n,i){return this._buffer.findMatchesLineByLine(e,t,n,i)}findMatches(e,t,n,i,r,s,o=999){this._assertNotDisposed();let a=null;null!==t&&(Array.isArray(t)||(t=[t]),t.every((e=>u.e.isIRange(e)))&&(a=t.map((e=>this.validateRange(e))))),null===a&&(a=[this.getFullModelRange()]),a=a.sort(((e,t)=>e.startLineNumber-t.startLineNumber||e.startColumn-t.startColumn));const l=[];let h;if(l.push(a.reduce(((e,t)=>u.e.areIntersecting(e,t)?e.plusRange(t):(l.push(e),t)))),!n&&e.indexOf("\n")<0){const t=new K.bc(e,n,i,r).parseSearchRequest();if(!t)return[];h=e=>this.findMatchesLineByLine(e,t,s,o)}else h=t=>K.pM.findMatches(this,new K.bc(e,n,i,r),t,s,o);return l.map(h).reduce(((e,t)=>e.concat(t)),[])}findNextMatch(e,t,n,i,r,s){this._assertNotDisposed();const o=this.validatePosition(t);if(!n&&e.indexOf("\n")<0){const t=new K.bc(e,n,i,r).parseSearchRequest();if(!t)return null;const a=this.getLineCount();let l=new u.e(o.lineNumber,o.column,a,this.getLineMaxColumn(a)),h=this.findMatchesLineByLine(l,t,s,1);return K.pM.findNextMatch(this,new K.bc(e,n,i,r),o,s),h.length>0?h[0]:(l=new u.e(1,1,o.lineNumber,this.getLineMaxColumn(o.lineNumber)),h=this.findMatchesLineByLine(l,t,s,1),h.length>0?h[0]:null)}return K.pM.findNextMatch(this,new K.bc(e,n,i,r),o,s)}findPreviousMatch(e,t,n,i,r,s){this._assertNotDisposed();const o=this.validatePosition(t);return K.pM.findPreviousMatch(this,new K.bc(e,n,i,r),o,s)}pushStackElement(){this._commandManager.pushStackElement()}popStackElement(){this._commandManager.popStackElement()}pushEOL(e){if(("\n"===this.getEOL()?0:1)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),null===this._initialUndoRedoSnapshot&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_validateEditOperation(e){return e instanceof d.Qi?e:new d.Qi(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}_validateEditOperations(e){const t=[];for(let n=0,i=e.length;n<i;n++)t[n]=this._validateEditOperation(e[n]);return t}pushEditOperations(e,t,n){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),n)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_pushEditOperations(e,t,n){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){let n=t.map((e=>({range:this.validateRange(e.range),text:e.text}))),i=!0;if(e)for(let t=0,r=e.length;t<r;t++){let r=e[t],s=!1;for(let e=0,t=n.length;e<t;e++){let t=n[e].range,i=t.startLineNumber>r.endLineNumber,o=r.startLineNumber>t.endLineNumber;if(!i&&!o){s=!0;break}}if(!s){i=!1;break}}if(i)for(let e=0,i=this._trimAutoWhitespaceLines.length;e<i;e++){let i=this._trimAutoWhitespaceLines[e],r=this.getLineMaxColumn(i),s=!0;for(let e=0,t=n.length;e<t;e++){let t=n[e].range,o=n[e].text;if(!(i<t.startLineNumber||i>t.endLineNumber)&&!(i===t.startLineNumber&&t.startColumn===r&&t.isEmpty()&&o&&o.length>0&&"\n"===o.charAt(0)||i===t.startLineNumber&&1===t.startColumn&&t.isEmpty()&&o&&o.length>0&&"\n"===o.charAt(o.length-1))){s=!1;break}}if(s){const e=new u.e(i,1,i,r);t.push(new d.Qi(null,e,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return null===this._initialUndoRedoSnapshot&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,n)}_applyUndo(e,t,n,i){const r=e.map((e=>{const t=this.getPositionAt(e.newPosition),n=this.getPositionAt(e.newEnd);return{range:new u.e(t.lineNumber,t.column,n.lineNumber,n.column),text:e.oldText}}));this._applyUndoRedoEdits(r,t,!0,!1,n,i)}_applyRedo(e,t,n,i){const r=e.map((e=>{const t=this.getPositionAt(e.oldPosition),n=this.getPositionAt(e.oldEnd);return{range:new u.e(t.lineNumber,t.column,n.lineNumber,n.column),text:e.newText}}));this._applyUndoRedoEdits(r,t,!1,!0,n,i)}_applyUndoRedoEdits(e,t,n,i,r,s){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=n,this._isRedoing=i,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(r)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(s),this._onDidChangeDecorations.endDeferredEmit()}}applyEdits(e,t=!1){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();const n=this._validateEditOperations(e);return this._doApplyEdits(n,t)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_doApplyEdits(e,t){const n=this._buffer.getLineCount(),i=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),r=this._buffer.getLineCount(),s=i.changes;if(this._trimAutoWhitespaceLines=i.trimAutoWhitespaceLineNumbers,0!==s.length){for(let e=0,t=s.length;e<t;e++){const t=s[e],[n,i,r]=(0,le.QZ)(t.text);this._tokens.acceptEdit(t.range,n,i),this._tokens2.acceptEdit(t.range,n,i,r,t.text.length>0?t.text.charCodeAt(0):0),this._decorationsTree.acceptReplace(t.rangeOffset,t.rangeLength,t.text.length,t.forceMoveMarkers)}let e=[];this._increaseVersionId();let t=n;for(let n=0,i=s.length;n<i;n++){const i=s[n],[o]=(0,le.QZ)(i.text);this._onDidChangeDecorations.fire();const a=i.range.startLineNumber,l=i.range.endLineNumber,u=l-a,c=o,d=Math.min(u,c),f=c-u,g=r-t-f+a,_=g,p=g+c,m=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new h.L(_,1)),this.getOffsetAt(new h.L(p,this.getLineMaxColumn(p))),0),L=fe.gk.fromDecorations(m),C=new ge.H9(L);for(let t=d;t>=0;t--){const n=a+t,i=g+t;C.takeFromEndWhile((e=>e.lineNumber>i));const r=C.takeFromEndWhile((e=>e.lineNumber===i));e.push(new fe.rU(n,this.getLineContent(i),r))}if(d<u){const t=a+d;e.push(new fe.lN(t+1,l))}if(d<c){const n=new ge.H9(L),i=a+d,s=c-d,o=r-t-s+i+1;let l=[],h=[];for(let e=0;e<s;e++){let t=o+e;h[e]=this.getLineContent(t),n.takeWhile((e=>e.lineNumber<t)),l[e]=n.takeWhile((e=>e.lineNumber===t))}e.push(new fe.Tx(i+1,a+c,h,l))}t+=f}this._emitContentChangedEvent(new fe.dQ(e,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:s,eol:this._buffer.getEOL(),versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return null===i.reverseEdits?void 0:i.reverseEdits}undo(){return this._undoRedoService.undo(this.uri)}canUndo(){return this._undoRedoService.canUndo(this.uri)}redo(){return this._undoRedoService.redo(this.uri)}canRedo(){return this._undoRedoService.canRedo(this.uri)}handleBeforeFireDecorationsChangedEvent(e){if(null===e||0===e.size)return;const t=[...e].map((e=>new fe.rU(e,this.getLineContent(e),this._getInjectedTextInLine(e))));this._onDidChangeContentOrInjectedText.fire(new fe.D8(t))}changeDecorations(e,t=0){this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_changeDecorations(e,t){let n={addDecoration:(t,n)=>this._deltaDecorationsImpl(e,[],[{range:t,options:n}])[0],changeDecoration:(e,t)=>{this._changeDecorationImpl(e,t)},changeDecorationOptions:(e,t)=>{this._changeDecorationOptionsImpl(e,Qe(t))},removeDecoration:t=>{this._deltaDecorationsImpl(e,[t],[])},deltaDecorations:(t,n)=>0===t.length&&0===n.length?[]:this._deltaDecorationsImpl(e,t,n)},r=null;try{r=t(n)}catch(e){(0,i.dL)(e)}return n.addDecoration=Oe,n.changeDecoration=Oe,n.changeDecorationOptions=Oe,n.removeDecoration=Oe,n.deltaDecorations=Oe,r}deltaDecorations(e,t,n=0){if(this._assertNotDisposed(),e||(e=[]),0===e.length&&0===t.length)return[];try{return this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(n,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_getTrackedRange(e){return this.getDecorationRange(e)}_setTrackedRange(e,t,n){const i=e?this._decorations[e]:null;if(!i)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:qe[n]}])[0]:null;if(!t)return this._decorationsTree.delete(i),delete this._decorations[i.id],null;const r=this._validateRangeRelaxedNoAllocations(t),s=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),o=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);return this._decorationsTree.delete(i),i.reset(this.getVersionId(),s,o,r),i.setOptions(qe[n]),this._decorationsTree.insert(i),i.id}removeAllDecorationsWithOwnerId(e){if(this._isDisposed)return;const t=this._decorationsTree.collectNodesFromOwner(e);for(let e=0,n=t.length;e<n;e++){const n=t[e];this._decorationsTree.delete(n),delete this._decorations[n.id]}}getDecorationOptions(e){const t=this._decorations[e];return t?t.options:null}getDecorationRange(e){const t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}getLineDecorations(e,t=0,n=!1){return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,n)}getLinesDecorations(e,t,n=0,i=!1){let r=this.getLineCount(),s=Math.min(r,Math.max(1,e)),o=Math.min(r,Math.max(1,t)),a=this.getLineMaxColumn(o);return this._getDecorationsInRange(new u.e(s,1,o,a),n,i)}getDecorationsInRange(e,t=0,n=!1){let i=this.validateRange(e);return this._getDecorationsInRange(i,t,n)}getOverviewRulerDecorations(e=0,t=!1){return this._decorationsTree.getAll(this,e,t,!0)}getInjectedTextDecorations(e=0){return this._decorationsTree.getAllInjectedText(this,e)}_getInjectedTextInLine(e){const t=this._buffer.getOffsetAt(e,1),n=t+this._buffer.getLineLength(e),i=this._decorationsTree.getInjectedTextInInterval(this,t,n,0);return fe.gk.fromDecorations(i).filter((t=>t.lineNumber===e))}getAllDecorations(e=0,t=!1){return this._decorationsTree.getAll(this,e,t,!1)}_getDecorationsInRange(e,t,n){const i=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),r=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,i,r,t,n)}getRangeAt(e,t){return this._buffer.getRangeAt(e,t-e)}_changeDecorationImpl(e,t){const n=this._decorations[e];if(!n)return;if(n.options.after){const t=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(t.endLineNumber)}if(n.options.before){const t=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(t.startLineNumber)}const i=this._validateRangeRelaxedNoAllocations(t),r=this._buffer.getOffsetAt(i.startLineNumber,i.startColumn),s=this._buffer.getOffsetAt(i.endLineNumber,i.endColumn);this._decorationsTree.delete(n),n.reset(this.getVersionId(),r,s,i),this._decorationsTree.insert(n),this._onDidChangeDecorations.checkAffectedAndFire(n.options),n.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.endLineNumber),n.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.startLineNumber)}_changeDecorationOptionsImpl(e,t){const n=this._decorations[e];if(!n)return;const i=!(!n.options.overviewRuler||!n.options.overviewRuler.color),r=!(!t.overviewRuler||!t.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(n.options),this._onDidChangeDecorations.checkAffectedAndFire(t),n.options.after||t.after){const e=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(e.endLineNumber)}if(n.options.before||t.before){const e=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(e.startLineNumber)}i!==r?(this._decorationsTree.delete(n),n.setOptions(t),this._decorationsTree.insert(n)):n.setOptions(t)}_deltaDecorationsImpl(e,t,n){const i=this.getVersionId(),r=t.length;let s=0;const o=n.length;let a=0,l=new Array(o);for(;s<r||a<o;){let h=null;if(s<r){do{h=this._decorations[t[s++]]}while(!h&&s<r);if(h){if(h.options.after){const e=this._decorationsTree.getNodeRange(this,h);this._onDidChangeDecorations.recordLineAffectedByInjectedText(e.endLineNumber)}if(h.options.before){const e=this._decorationsTree.getNodeRange(this,h);this._onDidChangeDecorations.recordLineAffectedByInjectedText(e.startLineNumber)}this._decorationsTree.delete(h),this._onDidChangeDecorations.checkAffectedAndFire(h.options)}}if(a<o){if(!h){const e=++this._lastDecorationId,t=`${this._instanceId};${e}`;h=new x(t,0,0),this._decorations[t]=h}const t=n[a],r=this._validateRangeRelaxedNoAllocations(t.range),s=Qe(t.options),o=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),u=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);h.ownerId=e,h.reset(i,o,u,r),h.setOptions(s),h.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(r.endLineNumber),h.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(r.startLineNumber),this._onDidChangeDecorations.checkAffectedAndFire(s),this._decorationsTree.insert(h),l[a]=h.id,a++}else h&&delete this._decorations[h.id]}return l}setTokens(e){if(0===e.length)return;let t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];let r=0,s=0,o=!1;for(let e=0,t=i.tokens.length;e<t;e++){const t=i.startLineNumber+e;if(o)this._tokens.setTokens(this._languageIdentifier.id,t-1,this._buffer.getLineLength(t),i.tokens[e],!1),s=t;else{this._tokens.setTokens(this._languageIdentifier.id,t-1,this._buffer.getLineLength(t),i.tokens[e],!0)&&(o=!0,r=t,s=t)}}o&&t.push({fromLineNumber:r,toLineNumber:s})}t.length>0&&this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:!1,ranges:t})}setSemanticTokens(e,t){this._tokens2.set(e,t),this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:null!==e,ranges:[{fromLineNumber:1,toLineNumber:this.getLineCount()}]})}hasCompleteSemanticTokens(){return this._tokens2.isComplete()}hasSomeSemanticTokens(){return!this._tokens2.isEmpty()}setPartialSemanticTokens(e,t){if(this.hasCompleteSemanticTokens())return;const n=this._tokens2.setPartial(e,t);this._emitModelTokensChangedEvent({tokenizationSupportChanged:!1,semanticTokensApplied:!0,ranges:[{fromLineNumber:n.startLineNumber,toLineNumber:n.endLineNumber}]})}tokenizeViewport(e,t){e=Math.max(1,e),t=Math.min(this._buffer.getLineCount(),t),this._tokenization.tokenizeViewport(e,t)}clearTokens(){this._tokens.flush(),this._emitModelTokensChangedEvent({tokenizationSupportChanged:!0,semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._buffer.getLineCount()}]})}_emitModelTokensChangedEvent(e){this._isDisposing||this._onDidChangeTokens.fire(e)}resetTokenization(){this._tokenization.reset()}forceTokenization(e){if(e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");this._tokenization.forceTokenization(e)}isCheapToTokenize(e){return this._tokenization.isCheapToTokenize(e)}tokenizeIfCheap(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}getLineTokens(e){if(e<1||e>this.getLineCount())throw new Error("Illegal value for lineNumber");return this._getLineTokens(e)}_getLineTokens(e){const t=this.getLineContent(e),n=this._tokens.getTokens(this._languageIdentifier.id,e-1,t);return this._tokens2.addSemanticTokens(e,n)}getLanguageIdentifier(){return this._languageIdentifier}getModeId(){return this._languageIdentifier.language}setMode(e){if(this._languageIdentifier.id===e.id)return;let t={oldLanguage:this._languageIdentifier.language,newLanguage:e.language};this._languageIdentifier=e,this._onDidChangeLanguage.fire(t),this._onDidChangeLanguageConfiguration.fire({})}getLanguageIdAtPosition(e,t){const n=this.validatePosition(new h.L(e,t)),i=this.getLineTokens(n.lineNumber);return i.getLanguageId(i.findTokenIndexAtOffset(n.column-1))}getWordAtPosition(e){this._assertNotDisposed();const t=this.validatePosition(e),n=this.getLineContent(t.lineNumber),i=this._getLineTokens(t.lineNumber),r=i.findTokenIndexAtOffset(t.column-1),[s,o]=ze._findLanguageBoundaries(i,r),a=(0,ve.t2)(t.column,Se.zu.getWordDefinition(i.getLanguageId(r)),n.substring(s,o),s);if(a&&a.startColumn<=e.column&&e.column<=a.endColumn)return a;if(r>0&&s===t.column-1){const[s,o]=ze._findLanguageBoundaries(i,r-1),a=(0,ve.t2)(t.column,Se.zu.getWordDefinition(i.getLanguageId(r-1)),n.substring(s,o),s);if(a&&a.startColumn<=e.column&&e.column<=a.endColumn)return a}return null}static _findLanguageBoundaries(e,t){const n=e.getLanguageId(t);let i=0;for(let r=t;r>=0&&e.getLanguageId(r)===n;r--)i=e.getStartOffset(r);let r=e.getLineContent().length;for(let i=t,s=e.getCount();i<s&&e.getLanguageId(i)===n;i++)r=e.getEndOffset(i);return[i,r]}getWordUntilPosition(e){const t=this.getWordAtPosition(e);return t?{word:t.word.substr(0,e.column-t.startColumn),startColumn:t.startColumn,endColumn:e.column}:{word:"",startColumn:e.column,endColumn:e.column}}findMatchingBracketUp(e,t){let n=e.toLowerCase(),i=this.validatePosition(t),r=this._getLineTokens(i.lineNumber),s=r.getLanguageId(r.findTokenIndexAtOffset(i.column-1)),o=Se.zu.getBracketsSupport(s);if(!o)return null;let a=o.textIsBracket[n];return a?Me(this._findMatchingBracketUp(a,i,null)):null}matchBracket(e){return this._matchBracket(this.validatePosition(e))}_establishBracketSearchOffsets(e,t,n,i){const r=t.getCount(),s=t.getLanguageId(i);let o=Math.max(0,e.column-1-n.maxBracketLength);for(let e=i-1;e>=0;e--){const n=t.getEndOffset(e);if(n<=o)break;if((0,xe.Bu)(t.getStandardTokenType(e))||t.getLanguageId(e)!==s){o=n;break}}let a=Math.min(t.getLineContent().length,e.column-1+n.maxBracketLength);for(let e=i+1;e<r;e++){const n=t.getStartOffset(e);if(n>=a)break;if((0,xe.Bu)(t.getStandardTokenType(e))||t.getLanguageId(e)!==s){a=n;break}}return{searchStartOffset:o,searchEndOffset:a}}_matchBracket(e){const t=e.lineNumber,n=this._getLineTokens(t),i=this._buffer.getLineContent(t),r=n.findTokenIndexAtOffset(e.column-1);if(r<0)return null;const s=Se.zu.getBracketsSupport(n.getLanguageId(r));if(s&&!(0,xe.Bu)(n.getStandardTokenType(r))){let{searchStartOffset:o,searchEndOffset:a}=this._establishBracketSearchOffsets(e,n,s,r),l=null;for(;;){const n=we.Vr.findNextBracketInRange(s.forwardRegex,t,i,o,a);if(!n)break;if(n.startColumn<=e.column&&e.column<=n.endColumn){const e=i.substring(n.startColumn-1,n.endColumn-1).toLowerCase(),t=this._matchFoundBracket(n,s.textIsBracket[e],s.textIsOpenBracket[e],null);if(t){if(t instanceof Re)return null;l=t}}o=n.endColumn-1}if(l)return l}if(r>0&&n.getStartOffset(r)===e.column-1){const s=r-1,o=Se.zu.getBracketsSupport(n.getLanguageId(s));if(o&&!(0,xe.Bu)(n.getStandardTokenType(s))){let{searchStartOffset:r,searchEndOffset:a}=this._establishBracketSearchOffsets(e,n,o,s);const l=we.Vr.findPrevBracketInRange(o.reversedRegex,t,i,r,a);if(l&&l.startColumn<=e.column&&e.column<=l.endColumn){const e=i.substring(l.startColumn-1,l.endColumn-1).toLowerCase(),t=this._matchFoundBracket(l,o.textIsBracket[e],o.textIsOpenBracket[e],null);if(t)return t instanceof Re?null:t}}}return null}_matchFoundBracket(e,t,n,i){if(!t)return null;const r=n?this._findMatchingBracketDown(t,e.getEndPosition(),i):this._findMatchingBracketUp(t,e.getStartPosition(),i);return r?r instanceof Re?r:[e,r]:null}_findMatchingBracketUp(e,t,n){const i=e.languageIdentifier.id,r=e.reversedRegex;let s=-1,o=0;const a=(t,i,a,l)=>{for(;;){if(n&&++o%100==0&&!n())return Re.INSTANCE;const h=we.Vr.findPrevBracketInRange(r,t,i,a,l);if(!h)break;const u=i.substring(h.startColumn-1,h.endColumn-1).toLowerCase();if(e.isOpen(u)?s++:e.isClose(u)&&s--,0===s)return h;l=h.startColumn-1}return null};for(let e=t.lineNumber;e>=1;e--){const n=this._getLineTokens(e),r=n.getCount(),s=this._buffer.getLineContent(e);let o=r-1,l=s.length,h=s.length;e===t.lineNumber&&(o=n.findTokenIndexAtOffset(t.column-1),l=t.column-1,h=t.column-1);let u=!0;for(;o>=0;o--){const t=n.getLanguageId(o)===i&&!(0,xe.Bu)(n.getStandardTokenType(o));if(t)u?l=n.getStartOffset(o):(l=n.getStartOffset(o),h=n.getEndOffset(o));else if(u&&l!==h){const t=a(e,s,l,h);if(t)return t}u=t}if(u&&l!==h){const t=a(e,s,l,h);if(t)return t}}return null}_findMatchingBracketDown(e,t,n){const i=e.languageIdentifier.id,r=e.forwardRegex;let s=1,o=0;const a=(t,i,a,l)=>{for(;;){if(n&&++o%100==0&&!n())return Re.INSTANCE;const h=we.Vr.findNextBracketInRange(r,t,i,a,l);if(!h)break;const u=i.substring(h.startColumn-1,h.endColumn-1).toLowerCase();if(e.isOpen(u)?s++:e.isClose(u)&&s--,0===s)return h;a=h.endColumn-1}return null},l=this.getLineCount();for(let e=t.lineNumber;e<=l;e++){const n=this._getLineTokens(e),r=n.getCount(),s=this._buffer.getLineContent(e);let o=0,l=0,h=0;e===t.lineNumber&&(o=n.findTokenIndexAtOffset(t.column-1),l=t.column-1,h=t.column-1);let u=!0;for(;o<r;o++){const t=n.getLanguageId(o)===i&&!(0,xe.Bu)(n.getStandardTokenType(o));if(t)u||(l=n.getStartOffset(o)),h=n.getEndOffset(o);else if(u&&l!==h){const t=a(e,s,l,h);if(t)return t}u=t}if(u&&l!==h){const t=a(e,s,l,h);if(t)return t}}return null}findPrevBracket(e){const t=this.validatePosition(e);let n=-1,i=null;for(let e=t.lineNumber;e>=1;e--){const r=this._getLineTokens(e),s=r.getCount(),o=this._buffer.getLineContent(e);let a=s-1,l=o.length,h=o.length;if(e===t.lineNumber){a=r.findTokenIndexAtOffset(t.column-1),l=t.column-1,h=t.column-1;const e=r.getLanguageId(a);n!==e&&(n=e,i=Se.zu.getBracketsSupport(n))}let u=!0;for(;a>=0;a--){const t=r.getLanguageId(a);if(n!==t){if(i&&u&&l!==h){const t=we.Vr.findPrevBracketInRange(i.reversedRegex,e,o,l,h);if(t)return this._toFoundBracket(i,t);u=!1}n=t,i=Se.zu.getBracketsSupport(n)}const s=!!i&&!(0,xe.Bu)(r.getStandardTokenType(a));if(s)u?l=r.getStartOffset(a):(l=r.getStartOffset(a),h=r.getEndOffset(a));else if(i&&u&&l!==h){const t=we.Vr.findPrevBracketInRange(i.reversedRegex,e,o,l,h);if(t)return this._toFoundBracket(i,t)}u=s}if(i&&u&&l!==h){const t=we.Vr.findPrevBracketInRange(i.reversedRegex,e,o,l,h);if(t)return this._toFoundBracket(i,t)}}return null}findNextBracket(e){const t=this.validatePosition(e),n=this.getLineCount();let i=-1,r=null;for(let e=t.lineNumber;e<=n;e++){const n=this._getLineTokens(e),s=n.getCount(),o=this._buffer.getLineContent(e);let a=0,l=0,h=0;if(e===t.lineNumber){a=n.findTokenIndexAtOffset(t.column-1),l=t.column-1,h=t.column-1;const e=n.getLanguageId(a);i!==e&&(i=e,r=Se.zu.getBracketsSupport(i))}let u=!0;for(;a<s;a++){const t=n.getLanguageId(a);if(i!==t){if(r&&u&&l!==h){const t=we.Vr.findNextBracketInRange(r.forwardRegex,e,o,l,h);if(t)return this._toFoundBracket(r,t);u=!1}i=t,r=Se.zu.getBracketsSupport(i)}const s=!!r&&!(0,xe.Bu)(n.getStandardTokenType(a));if(s)u||(l=n.getStartOffset(a)),h=n.getEndOffset(a);else if(r&&u&&l!==h){const t=we.Vr.findNextBracketInRange(r.forwardRegex,e,o,l,h);if(t)return this._toFoundBracket(r,t)}u=s}if(r&&u&&l!==h){const t=we.Vr.findNextBracketInRange(r.forwardRegex,e,o,l,h);if(t)return this._toFoundBracket(r,t)}}return null}findEnclosingBrackets(e,t){let n;if(void 0===t)n=null;else{const e=Date.now();n=()=>Date.now()-e<=t}const i=this.validatePosition(e),r=this.getLineCount(),s=new Map;let o=[];const a=(e,t)=>{if(!s.has(e)){let n=[];for(let e=0,i=t?t.brackets.length:0;e<i;e++)n[e]=0;s.set(e,n)}o=s.get(e)};let l=0;const h=(e,t,i,r,s)=>{for(;;){if(n&&++l%100==0&&!n())return Re.INSTANCE;const a=we.Vr.findNextBracketInRange(e.forwardRegex,t,i,r,s);if(!a)break;const h=i.substring(a.startColumn-1,a.endColumn-1).toLowerCase(),u=e.textIsBracket[h];if(u&&(u.isOpen(h)?o[u.index]++:u.isClose(h)&&o[u.index]--,-1===o[u.index]))return this._matchFoundBracket(a,u,!1,n);r=a.endColumn-1}return null};let u=-1,c=null;for(let e=i.lineNumber;e<=r;e++){const t=this._getLineTokens(e),n=t.getCount(),r=this._buffer.getLineContent(e);let s=0,o=0,l=0;if(e===i.lineNumber){s=t.findTokenIndexAtOffset(i.column-1),o=i.column-1,l=i.column-1;const e=t.getLanguageId(s);u!==e&&(u=e,c=Se.zu.getBracketsSupport(u),a(u,c))}let d=!0;for(;s<n;s++){const n=t.getLanguageId(s);if(u!==n){if(c&&d&&o!==l){const t=h(c,e,r,o,l);if(t)return Me(t);d=!1}u=n,c=Se.zu.getBracketsSupport(u),a(u,c)}const i=!!c&&!(0,xe.Bu)(t.getStandardTokenType(s));if(i)d||(o=t.getStartOffset(s)),l=t.getEndOffset(s);else if(c&&d&&o!==l){const t=h(c,e,r,o,l);if(t)return Me(t)}d=i}if(c&&d&&o!==l){const t=h(c,e,r,o,l);if(t)return Me(t)}}return null}_toFoundBracket(e,t){if(!t)return null;let n=this.getValueInRange(t);n=n.toLowerCase();let i=e.textIsBracket[n];return i?{range:t,open:i.open,close:i.close,isOpen:e.textIsOpenBracket[n]}:null}static computeIndentLevel(e,t){let n=0,i=0,r=e.length;for(;i<r;){let r=e.charCodeAt(i);if(32===r)n++;else{if(9!==r)break;n=n-n%t+t}i++}return i===r?-1:n}_computeIndentLevel(e){return ze.computeIndentLevel(this._buffer.getLineContent(e+1),this._options.tabSize)}getActiveIndentGuide(e,t,n){this._assertNotDisposed();const i=this.getLineCount();if(e<1||e>i)throw new Error("Illegal value for lineNumber");const r=Se.zu.getFoldingRules(this._languageIdentifier.id),s=Boolean(r&&r.offSide);let o=-2,a=-1,l=-2,h=-1;const u=e=>{if(-1!==o&&(-2===o||o>e-1)){o=-1,a=-1;for(let t=e-2;t>=0;t--){let e=this._computeIndentLevel(t);if(e>=0){o=t,a=e;break}}}if(-2===l){l=-1,h=-1;for(let t=e;t<i;t++){let e=this._computeIndentLevel(t);if(e>=0){l=t,h=e;break}}}};let c=-2,d=-1,f=-2,g=-1;const _=e=>{if(-2===c){c=-1,d=-1;for(let t=e-2;t>=0;t--){let e=this._computeIndentLevel(t);if(e>=0){c=t,d=e;break}}}if(-1!==f&&(-2===f||f<e-1)){f=-1,g=-1;for(let t=e;t<i;t++){let e=this._computeIndentLevel(t);if(e>=0){f=t,g=e;break}}}};let p=0,m=!0,L=0,C=!0,b=0,N=0;for(let r=0;m||C;r++){const o=e-r,f=e+r;r>1&&(o<1||o<t)&&(m=!1),r>1&&(f>i||f>n)&&(C=!1),r>5e4&&(m=!1,C=!1);let I=-1;if(m){const e=this._computeIndentLevel(o-1);e>=0?(l=o-1,h=e,I=Math.ceil(e/this._options.indentSize)):(u(o),I=this._getIndentLevelForWhitespaceLine(s,a,h))}let v=-1;if(C){const e=this._computeIndentLevel(f-1);e>=0?(c=f-1,d=e,v=Math.ceil(e/this._options.indentSize)):(_(f),v=this._getIndentLevelForWhitespaceLine(s,d,g))}if(0!==r){if(1===r){if(f<=i&&v>=0&&N+1===v){m=!1,p=f,L=f,b=v;continue}if(o>=1&&I>=0&&I-1===N){C=!1,p=o,L=o,b=I;continue}if(p=e,L=e,b=N,0===b)return{startLineNumber:p,endLineNumber:L,indent:b}}m&&(I>=b?p=o:m=!1),C&&(v>=b?L=f:C=!1)}else N=I}return{startLineNumber:p,endLineNumber:L,indent:b}}getLinesIndentGuides(e,t){this._assertNotDisposed();const n=this.getLineCount();if(e<1||e>n)throw new Error("Illegal value for startLineNumber");if(t<1||t>n)throw new Error("Illegal value for endLineNumber");const i=Se.zu.getFoldingRules(this._languageIdentifier.id),r=Boolean(i&&i.offSide);let s=new Array(t-e+1),o=-2,a=-1,l=-2,h=-1;for(let i=e;i<=t;i++){let t=i-e;const u=this._computeIndentLevel(i-1);if(u>=0)o=i-1,a=u,s[t]=Math.ceil(u/this._options.indentSize);else{if(-2===o){o=-1,a=-1;for(let e=i-2;e>=0;e--){let t=this._computeIndentLevel(e);if(t>=0){o=e,a=t;break}}}if(-1!==l&&(-2===l||l<i-1)){l=-1,h=-1;for(let e=i;e<n;e++){let t=this._computeIndentLevel(e);if(t>=0){l=e,h=t;break}}}s[t]=this._getIndentLevelForWhitespaceLine(r,a,h)}}return s}_getIndentLevelForWhitespaceLine(e,t,n){return-1===t||-1===n?0:t<n?1+Math.floor(t/this._options.indentSize):t===n||e?Math.ceil(n/this._options.indentSize):1+Math.floor(n/this._options.indentSize)}normalizePosition(e,t){return e}getLineIndentColumn(e){return function(e){let t=0;for(const n of e){if(" "!==n&&"\t"!==n)break;t++}return t}(this.getLineContent(e))+1}}function Be(e){return!(!e.options.overviewRuler||!e.options.overviewRuler.color)}function ye(e){return!!e.options.after||!!e.options.before}ze.MODEL_SYNC_LIMIT=52428800,ze.LARGE_FILE_SIZE_THRESHOLD=20971520,ze.LARGE_FILE_LINE_COUNT_THRESHOLD=3e5,ze.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:l.DB.tabSize,indentSize:l.DB.indentSize,insertSpaces:l.DB.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:l.DB.trimAutoWhitespace,largeFileOptimizations:l.DB.largeFileOptimizations};class Pe{constructor(){this._decorationsTree0=new k,this._decorationsTree1=new k,this._injectedTextDecorationsTree=new k}ensureAllNodesHaveRanges(e){this.getAll(e,0,!1,!1)}_ensureNodesHaveRanges(e,t){for(const n of t)null===n.range&&(n.range=e.getRangeAt(n.cachedAbsoluteStart,n.cachedAbsoluteEnd));return t}getAllInInterval(e,t,n,i,r){const s=e.getVersionId(),o=this._intervalSearch(t,n,i,r,s);return this._ensureNodesHaveRanges(e,o)}_intervalSearch(e,t,n,i,r){const s=this._decorationsTree0.intervalSearch(e,t,n,i,r),o=this._decorationsTree1.intervalSearch(e,t,n,i,r),a=this._injectedTextDecorationsTree.intervalSearch(e,t,n,i,r);return s.concat(o).concat(a)}getInjectedTextInInterval(e,t,n,i){const r=e.getVersionId(),s=this._injectedTextDecorationsTree.intervalSearch(t,n,i,!1,r);return this._ensureNodesHaveRanges(e,s)}getAllInjectedText(e,t){const n=e.getVersionId(),i=this._injectedTextDecorationsTree.search(t,!1,n);return this._ensureNodesHaveRanges(e,i)}getAll(e,t,n,i){const r=e.getVersionId(),s=this._search(t,n,i,r);return this._ensureNodesHaveRanges(e,s)}_search(e,t,n,i){if(n)return this._decorationsTree1.search(e,t,i);{const n=this._decorationsTree0.search(e,t,i),r=this._decorationsTree1.search(e,t,i),s=this._injectedTextDecorationsTree.search(e,t,i);return n.concat(r).concat(s)}}collectNodesFromOwner(e){const t=this._decorationsTree0.collectNodesFromOwner(e),n=this._decorationsTree1.collectNodesFromOwner(e),i=this._injectedTextDecorationsTree.collectNodesFromOwner(e);return t.concat(n).concat(i)}collectNodesPostOrder(){const e=this._decorationsTree0.collectNodesPostOrder(),t=this._decorationsTree1.collectNodesPostOrder(),n=this._injectedTextDecorationsTree.collectNodesPostOrder();return e.concat(t).concat(n)}insert(e){ye(e)?this._injectedTextDecorationsTree.insert(e):Be(e)?this._decorationsTree1.insert(e):this._decorationsTree0.insert(e)}delete(e){ye(e)?this._injectedTextDecorationsTree.delete(e):Be(e)?this._decorationsTree1.delete(e):this._decorationsTree0.delete(e)}getNodeRange(e,t){const n=e.getVersionId();return t.cachedVersionId!==n&&this._resolveNode(t,n),null===t.range&&(t.range=e.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd)),t.range}_resolveNode(e,t){ye(e)?this._injectedTextDecorationsTree.resolveNode(e,t):Be(e)?this._decorationsTree1.resolveNode(e,t):this._decorationsTree0.resolveNode(e,t)}acceptReplace(e,t,n,i){this._decorationsTree0.acceptReplace(e,t,n,i),this._decorationsTree1.acceptReplace(e,t,n,i),this._injectedTextDecorationsTree.acceptReplace(e,t,n,i)}}function Fe(e){return e.replace(/[^a-z0-9\-_]/gi," ")}class Ve{constructor(e){this.color=e.color||"",this.darkColor=e.darkColor||""}}class We extends Ve{constructor(e){super(e),this._resolvedColor=null,this.position="number"==typeof e.position?e.position:d.sh.Center}getColor(e){return this._resolvedColor||("light"!==e.type&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=null}_resolveColor(e,t){if("string"==typeof e)return e;let n=e?t.getColor(e.id):null;return n?n.toString():""}}class Ue extends Ve{constructor(e){super(e),this.position=e.position}getColor(e){return this._resolvedColor||("light"!==e.type&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=void 0}_resolveColor(e,t){return"string"==typeof e?ke.Il.fromHex(e):t.getColor(e.id)}}class He{constructor(e){this.content=e.content||"",this.inlineClassName=e.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1}static from(e){return e instanceof He?e:new He(e)}}class je{constructor(e){this.description=e.description,this.stickiness=e.stickiness||0,this.zIndex=e.zIndex||0,this.className=e.className?Fe(e.className):null,this.hoverMessage=e.hoverMessage||null,this.glyphMarginHoverMessage=e.glyphMarginHoverMessage||null,this.isWholeLine=e.isWholeLine||!1,this.showIfCollapsed=e.showIfCollapsed||!1,this.collapseOnReplaceEdit=e.collapseOnReplaceEdit||!1,this.overviewRuler=e.overviewRuler?new We(e.overviewRuler):null,this.minimap=e.minimap?new Ue(e.minimap):null,this.glyphMarginClassName=e.glyphMarginClassName?Fe(e.glyphMarginClassName):null,this.linesDecorationsClassName=e.linesDecorationsClassName?Fe(e.linesDecorationsClassName):null,this.firstLineDecorationClassName=e.firstLineDecorationClassName?Fe(e.firstLineDecorationClassName):null,this.marginClassName=e.marginClassName?Fe(e.marginClassName):null,this.inlineClassName=e.inlineClassName?Fe(e.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=e.beforeContentClassName?Fe(e.beforeContentClassName):null,this.afterContentClassName=e.afterContentClassName?Fe(e.afterContentClassName):null,this.after=e.after?He.from(e.after):null,this.before=e.before?He.from(e.before):null}static register(e){return new je(e)}static createDynamic(e){return new je(e)}}je.EMPTY=je.register({description:"empty"});const qe=[je.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),je.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),je.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),je.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function Qe(e){return e instanceof je?e:je.createDynamic(e)}class $e extends s.JT{constructor(e){super(),this.handleBeforeFire=e,this._actual=this._register(new r.Q5),this.event=this._actual.event,this._affectedInjectedTextLines=null,this._deferredCnt=0,this._shouldFire=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(){var e;if(this._deferredCnt--,0===this._deferredCnt){if(this._shouldFire){this.handleBeforeFire(this._affectedInjectedTextLines);const e={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler};this._shouldFire=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._actual.fire(e)}null===(e=this._affectedInjectedTextLines)||void 0===e||e.clear(),this._affectedInjectedTextLines=null}}recordLineAffectedByInjectedText(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}checkAffectedAndFire(e){this._affectsMinimap||(this._affectsMinimap=!(!e.minimap||!e.minimap.position)),this._affectsOverviewRuler||(this._affectsOverviewRuler=!(!e.overviewRuler||!e.overviewRuler.color)),this._shouldFire=!0}fire(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._shouldFire=!0}}class Ze extends s.JT{constructor(){super(),this._fastEmitter=this._register(new r.Q5),this.fastEvent=this._fastEmitter.event,this._slowEmitter=this._register(new r.Q5),this.slowEvent=this._slowEmitter.event,this._deferredCnt=0,this._deferredEvent=null}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(e=null){if(this._deferredCnt--,0===this._deferredCnt&&null!==this._deferredEvent){this._deferredEvent.rawContentChangedEvent.resultingSelection=e;const t=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(t),this._slowEmitter.fire(t)}}fire(e){this._deferredCnt>0?this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(e):this._deferredEvent=e:(this._fastEmitter.fire(e),this._slowEmitter.fire(e))}}},83256:function(e,t,n){n.d(t,{Jx:function(){return i},gk:function(){return r},rU:function(){return s},lN:function(){return o},Tx:function(){return a},CZ:function(){return l},dQ:function(){return h},D8:function(){return u},fV:function(){return c}});class i{constructor(){this.changeType=1}}class r{constructor(e,t,n,i,r){this.ownerId=e,this.lineNumber=t,this.column=n,this.options=i,this.order=r}static applyInjectedText(e,t){if(!t||0===t.length)return e;let n="",i=0;for(const r of t)n+=e.substring(i,r.column-1),i=r.column-1,n+=r.options.content;return n+=e.substring(i),n}static fromDecorations(e){const t=[];for(const n of e)n.options.before&&n.options.before.content.length>0&&t.push(new r(n.ownerId,n.range.startLineNumber,n.range.startColumn,n.options.before,0)),n.options.after&&n.options.after.content.length>0&&t.push(new r(n.ownerId,n.range.endLineNumber,n.range.endColumn,n.options.after,1));return t.sort(((e,t)=>e.lineNumber===t.lineNumber?e.column===t.column?e.order-t.order:e.column-t.column:e.lineNumber-t.lineNumber)),t}}class s{constructor(e,t,n){this.changeType=2,this.lineNumber=e,this.detail=t,this.injectedText=n}}class o{constructor(e,t){this.changeType=3,this.fromLineNumber=e,this.toLineNumber=t}}class a{constructor(e,t,n,i){this.changeType=4,this.injectedTexts=i,this.fromLineNumber=e,this.toLineNumber=t,this.detail=n}}class l{constructor(){this.changeType=5}}class h{constructor(e,t,n,i){this.changes=e,this.versionId=t,this.isUndoing=n,this.isRedoing=i,this.resultingSelection=null}containsEvent(e){for(let t=0,n=this.changes.length;t<n;t++){if(this.changes[t].changeType===e)return!0}return!1}static merge(e,t){const n=[].concat(e.changes).concat(t.changes),i=t.versionId,r=e.isUndoing||t.isUndoing,s=e.isRedoing||t.isRedoing;return new h(n,i,r,s)}}class u{constructor(e){this.changes=e}}class c{constructor(e,t){this.rawContentChangedEvent=e,this.contentChangedEvent=t}merge(e){const t=h.merge(this.rawContentChangedEvent,e.rawContentChangedEvent),n=c._mergeChangeEvents(this.contentChangedEvent,e.contentChangedEvent);return new c(t,n)}static _mergeChangeEvents(e,t){return{changes:[].concat(e.changes).concat(t.changes),eol:t.eol,versionId:t.versionId,isUndoing:e.isUndoing||t.isUndoing,isRedoing:e.isRedoing||t.isRedoing,isFlush:e.isFlush||t.isFlush}}}},77277:function(e,t,n){n.d(t,{bc:function(){return l},iE:function(){return u},pM:function(){return d},cM:function(){return f},sz:function(){return g}});var i=n(97295),r=n(59410),s=n(50187),o=n(24314),a=n(84973);class l{constructor(e,t,n,i){this.searchString=e,this.isRegex=t,this.matchCase=n,this.wordSeparators=i}parseSearchRequest(){if(""===this.searchString)return null;let e;e=this.isRegex?function(e){if(!e||0===e.length)return!1;for(let t=0,n=e.length;t<n;t++){if(92===e.charCodeAt(t)){if(t++,t>=n)break;const i=e.charCodeAt(t);if(110===i||114===i||87===i||119===i)return!0}}return!1}(this.searchString):this.searchString.indexOf("\n")>=0;let t=null;try{t=i.GF(this.searchString,this.isRegex,{matchCase:this.matchCase,wholeWord:!1,multiline:e,global:!0,unicode:!0})}catch(e){return null}if(!t)return null;let n=!this.isRegex&&!e;return n&&this.searchString.toLowerCase()!==this.searchString.toUpperCase()&&(n=this.matchCase),new h(t,this.wordSeparators?(0,r.u)(this.wordSeparators):null,n?this.searchString:null)}}class h{constructor(e,t,n){this.regex=e,this.wordSeparators=t,this.simpleSearch=n}}function u(e,t,n){if(!n)return new a.tk(e,null);let i=[];for(let e=0,n=t.length;e<n;e++)i[e]=t[e];return new a.tk(e,i)}class c{constructor(e){let t=[],n=0;for(let i=0,r=e.length;i<r;i++)10===e.charCodeAt(i)&&(t[n++]=i);this._lineFeedsOffsets=t}findLineFeedCountBeforeOffset(e){const t=this._lineFeedsOffsets;let n=0,i=t.length-1;if(-1===i)return 0;if(e<=t[0])return 0;for(;n<i;){const r=n+((i-n)/2>>0);t[r]>=e?i=r-1:t[r+1]>=e?(n=r,i=r):n=r+1}return n+1}}class d{static findMatches(e,t,n,i,r){const s=t.parseSearchRequest();return s?s.regex.multiline?this._doFindMatchesMultiline(e,n,new g(s.wordSeparators,s.regex),i,r):this._doFindMatchesLineByLine(e,n,s,i,r):[]}static _getMultilineMatchRange(e,t,n,i,r,s){let a,l,h=0;if(i?(h=i.findLineFeedCountBeforeOffset(r),a=t+r+h):a=t+r,i){let e=i.findLineFeedCountBeforeOffset(r+s.length)-h;l=a+s.length+e}else l=a+s.length;const u=e.getPositionAt(a),c=e.getPositionAt(l);return new o.e(u.lineNumber,u.column,c.lineNumber,c.column)}static _doFindMatchesMultiline(e,t,n,i,r){const s=e.getOffsetAt(t.getStartPosition()),o=e.getValueInRange(t,1),a="\r\n"===e.getEOL()?new c(o):null,l=[];let h,d=0;for(n.reset(0);h=n.next(o);)if(l[d++]=u(this._getMultilineMatchRange(e,s,o,a,h.index,h[0]),h,i),d>=r)return l;return l}static _doFindMatchesLineByLine(e,t,n,i,r){const s=[];let o=0;if(t.startLineNumber===t.endLineNumber){const a=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);return o=this._findMatchesInLine(n,a,t.startLineNumber,t.startColumn-1,o,s,i,r),s}const a=e.getLineContent(t.startLineNumber).substring(t.startColumn-1);o=this._findMatchesInLine(n,a,t.startLineNumber,t.startColumn-1,o,s,i,r);for(let a=t.startLineNumber+1;a<t.endLineNumber&&o<r;a++)o=this._findMatchesInLine(n,e.getLineContent(a),a,0,o,s,i,r);if(o<r){const a=e.getLineContent(t.endLineNumber).substring(0,t.endColumn-1);o=this._findMatchesInLine(n,a,t.endLineNumber,0,o,s,i,r)}return s}static _findMatchesInLine(e,t,n,i,r,s,l,h){const c=e.wordSeparators;if(!l&&e.simpleSearch){const l=e.simpleSearch,u=l.length,d=t.length;let g=-u;for(;-1!==(g=t.indexOf(l,g+u));)if((!c||f(c,t,d,g,u))&&(s[r++]=new a.tk(new o.e(n,g+1+i,n,g+1+u+i),null),r>=h))return r;return r}const d=new g(e.wordSeparators,e.regex);let _;d.reset(0);do{if(_=d.next(t),_&&(s[r++]=u(new o.e(n,_.index+1+i,n,_.index+1+_[0].length+i),_,l),r>=h))return r}while(_);return r}static findNextMatch(e,t,n,i){const r=t.parseSearchRequest();if(!r)return null;const s=new g(r.wordSeparators,r.regex);return r.regex.multiline?this._doFindNextMatchMultiline(e,n,s,i):this._doFindNextMatchLineByLine(e,n,s,i)}static _doFindNextMatchMultiline(e,t,n,i){const r=new s.L(t.lineNumber,1),a=e.getOffsetAt(r),l=e.getLineCount(),h=e.getValueInRange(new o.e(r.lineNumber,r.column,l,e.getLineMaxColumn(l)),1),d="\r\n"===e.getEOL()?new c(h):null;n.reset(t.column-1);let f=n.next(h);return f?u(this._getMultilineMatchRange(e,a,h,d,f.index,f[0]),f,i):1!==t.lineNumber||1!==t.column?this._doFindNextMatchMultiline(e,new s.L(1,1),n,i):null}static _doFindNextMatchLineByLine(e,t,n,i){const r=e.getLineCount(),s=t.lineNumber,o=e.getLineContent(s),a=this._findFirstMatchInLine(n,o,s,t.column,i);if(a)return a;for(let t=1;t<=r;t++){const o=(s+t-1)%r,a=e.getLineContent(o+1),l=this._findFirstMatchInLine(n,a,o+1,1,i);if(l)return l}return null}static _findFirstMatchInLine(e,t,n,i,r){e.reset(i-1);const s=e.next(t);return s?u(new o.e(n,s.index+1,n,s.index+1+s[0].length),s,r):null}static findPreviousMatch(e,t,n,i){const r=t.parseSearchRequest();if(!r)return null;const s=new g(r.wordSeparators,r.regex);return r.regex.multiline?this._doFindPreviousMatchMultiline(e,n,s,i):this._doFindPreviousMatchLineByLine(e,n,s,i)}static _doFindPreviousMatchMultiline(e,t,n,i){const r=this._doFindMatchesMultiline(e,new o.e(1,1,t.lineNumber,t.column),n,i,9990);if(r.length>0)return r[r.length-1];const a=e.getLineCount();return t.lineNumber!==a||t.column!==e.getLineMaxColumn(a)?this._doFindPreviousMatchMultiline(e,new s.L(a,e.getLineMaxColumn(a)),n,i):null}static _doFindPreviousMatchLineByLine(e,t,n,i){const r=e.getLineCount(),s=t.lineNumber,o=e.getLineContent(s).substring(0,t.column-1),a=this._findLastMatchInLine(n,o,s,i);if(a)return a;for(let t=1;t<=r;t++){const o=(r+s-t-1)%r,a=e.getLineContent(o+1),l=this._findLastMatchInLine(n,a,o+1,i);if(l)return l}return null}static _findLastMatchInLine(e,t,n,i){let r,s=null;for(e.reset(0);r=e.next(t);)s=u(new o.e(n,r.index+1,n,r.index+1+r[0].length),r,i);return s}}function f(e,t,n,i,r){return function(e,t,n,i,r){if(0===i)return!0;const s=t.charCodeAt(i-1);if(0!==e.get(s))return!0;if(13===s||10===s)return!0;if(r>0){const n=t.charCodeAt(i);if(0!==e.get(n))return!0}return!1}(e,t,0,i,r)&&function(e,t,n,i,r){if(i+r===n)return!0;const s=t.charCodeAt(i+r);if(0!==e.get(s))return!0;if(13===s||10===s)return!0;if(r>0){const n=t.charCodeAt(i+r-1);if(0!==e.get(n))return!0}return!1}(e,t,n,i,r)}class g{constructor(e,t){this._wordSeparators=e,this._searchRegex=t,this._prevMatchStartIndex=-1,this._prevMatchLength=0}reset(e){this._searchRegex.lastIndex=e,this._prevMatchStartIndex=-1,this._prevMatchLength=0}next(e){const t=e.length;let n;do{if(this._prevMatchStartIndex+this._prevMatchLength===t)return null;if(n=this._searchRegex.exec(e),!n)return null;const r=n.index,s=n[0].length;if(r===this._prevMatchStartIndex&&s===this._prevMatchLength){if(0===s){i.ZH(e,t,this._searchRegex.lastIndex)>65535?this._searchRegex.lastIndex+=2:this._searchRegex.lastIndex+=1;continue}return null}if(this._prevMatchStartIndex=r,this._prevMatchLength=s,!this._wordSeparators||f(this._wordSeparators,e,t,r,s))return n}while(n);return null}}},58409:function(e,t,n){n.d(t,{QZ:function(){return l},DA:function(){return c},OU:function(){return d},Wz:function(){return g},cx:function(){return m},Rl:function(){return L}});var i=n(9488),r=n(78411),s=n(50187),o=n(24314),a=n(44101);function l(e){let t=0,n=0,i=0,r=0;for(let s=0,o=e.length;s<o;s++){const a=e.charCodeAt(s);13===a?(0===t&&(n=s),t++,s+1<o&&10===e.charCodeAt(s+1)?(r|=2,s++):r|=3,i=s+1):10===a&&(r|=1,0===t&&(n=s),t++,i=s+1)}return 0===t&&(n=e.length),[t,n,e.length-i,r]}function h(e){return(16384|e<<0|2<<23)>>>0}const u=new Uint32Array(0).buffer;class c{constructor(){this.tokens=[]}add(e,t){if(this.tokens.length>0){const n=this.tokens[this.tokens.length-1];if(n.startLineNumber+n.tokens.length-1+1===e)return void n.tokens.push(t)}this.tokens.push(new _(e,[t]))}}class d{constructor(e){this._tokens=e,this._tokenCount=e.length/4}toString(e){let t=[];for(let n=0;n<this._tokenCount;n++)t.push(`(${this._getDeltaLine(n)+e},${this._getStartCharacter(n)}-${this._getEndCharacter(n)})`);return`[${t.join(",")}]`}getMaxDeltaLine(){const e=this._getTokenCount();return 0===e?-1:this._getDeltaLine(e-1)}getRange(){const e=this._getTokenCount();if(0===e)return null;const t=this._getStartCharacter(0),n=this._getDeltaLine(e-1),i=this._getEndCharacter(e-1);return new o.e(0,t+1,n,i+1)}_getTokenCount(){return this._tokenCount}_getDeltaLine(e){return this._tokens[4*e]}_getStartCharacter(e){return this._tokens[4*e+1]}_getEndCharacter(e){return this._tokens[4*e+2]}isEmpty(){return 0===this._getTokenCount()}getLineTokens(e){let t=0,n=this._getTokenCount()-1;for(;t<n;){const i=t+Math.floor((n-t)/2),r=this._getDeltaLine(i);if(r<e)t=i+1;else{if(!(r>e)){let r=i;for(;r>t&&this._getDeltaLine(r-1)===e;)r--;let s=i;for(;s<n&&this._getDeltaLine(s+1)===e;)s++;return new f(this._tokens.subarray(4*r,4*s+4))}n=i-1}}return this._getDeltaLine(t)===e?new f(this._tokens.subarray(4*t,4*t+4)):null}clear(){this._tokenCount=0}removeTokens(e,t,n,i){const r=this._tokens,s=this._tokenCount;let o=0,a=!1,l=0;for(let h=0;h<s;h++){const s=4*h,u=r[s],c=r[s+1],d=r[s+2],f=r[s+3];if((u>e||u===e&&d>=t)&&(u<n||u===n&&c<=i))a=!0;else{if(0===o&&(l=u),a){const e=4*o;r[e]=u-l,r[e+1]=c,r[e+2]=d,r[e+3]=f}o++}}return this._tokenCount=o,l}split(e,t,n,i){const r=this._tokens,s=this._tokenCount;let o=[],a=[],l=o,h=0,u=0;for(let o=0;o<s;o++){const s=4*o,c=r[s],d=r[s+1],f=r[s+2],g=r[s+3];if(c>e||c===e&&f>=t){if(c<n||c===n&&d<=i)continue;l!==a&&(l=a,h=0,u=c)}l[h++]=c-u,l[h++]=d,l[h++]=f,l[h++]=g}return[new d(new Uint32Array(o)),new d(new Uint32Array(a)),u]}acceptDeleteRange(e,t,n,i,r){const s=this._tokens,o=this._tokenCount,a=i-t;let l=0,h=!1;for(let u=0;u<o;u++){const c=4*u;let d=s[c],f=s[c+1],g=s[c+2];const _=s[c+3];if(d<t||d===t&&g<=n){l++;continue}if(d===t&&f<n)d===i&&g>r?g-=r-n:g=n;else if(d===t&&f===n){if(!(d===i&&g>r)){h=!0;continue}g-=r-n}else if(d<i||d===i&&f<r){if(!(d===i&&g>r)){h=!0;continue}d===t?(f=n,g=f+(g-r)):(f=0,g=f+(g-r))}else if(d>i){if(0===a&&!h){l=o;break}d-=a}else{if(!(d===i&&f>=r))throw new Error("Not possible!");e&&0===d&&(f+=e,g+=e),d-=a,f-=r-n,g-=r-n}const p=4*l;s[p]=d,s[p+1]=f,s[p+2]=g,s[p+3]=_,l++}this._tokenCount=l}acceptInsertText(e,t,n,i,r,s){const o=0===n&&1===i&&(s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122),a=this._tokens,l=this._tokenCount;for(let s=0;s<l;s++){const l=4*s;let h=a[l],u=a[l+1],c=a[l+2];if(!(h<e||h===e&&c<t)){if(h===e&&c===t){if(!o)continue;c+=1}else if(h===e&&u<t&&t<c)0===n?c+=i:c=t;else{if(h===e&&u===t&&o)continue;if(h===e)if(h+=n,0===n)u+=i,c+=i;else{const e=c-u;u=r+(u-t),c=u+e}else h+=n}a[l]=h,a[l+1]=u,a[l+2]=c}}}}class f{constructor(e){this._tokens=e}getCount(){return this._tokens.length/4}getStartCharacter(e){return this._tokens[4*e+1]}getEndCharacter(e){return this._tokens[4*e+2]}getMetadata(e){return this._tokens[4*e+3]}}class g{constructor(e,t){this.startLineNumber=e,this.tokens=t,this.endLineNumber=this.startLineNumber+this.tokens.getMaxDeltaLine()}toString(){return this.tokens.toString(this.startLineNumber)}_updateEndLineNumber(){this.endLineNumber=this.startLineNumber+this.tokens.getMaxDeltaLine()}isEmpty(){return this.tokens.isEmpty()}getLineTokens(e){return this.startLineNumber<=e&&e<=this.endLineNumber?this.tokens.getLineTokens(e-this.startLineNumber):null}getRange(){const e=this.tokens.getRange();return e?new o.e(this.startLineNumber+e.startLineNumber,e.startColumn,this.startLineNumber+e.endLineNumber,e.endColumn):e}removeTokens(e){const t=e.startLineNumber-this.startLineNumber,n=e.endLineNumber-this.startLineNumber;this.startLineNumber+=this.tokens.removeTokens(t,e.startColumn-1,n,e.endColumn-1),this._updateEndLineNumber()}split(e){const t=e.startLineNumber-this.startLineNumber,n=e.endLineNumber-this.startLineNumber,[i,r,s]=this.tokens.split(t,e.startColumn-1,n,e.endColumn-1);return[new g(this.startLineNumber,i),new g(this.startLineNumber+s,r)]}applyEdit(e,t){const[n,i,r]=l(t);this.acceptEdit(e,n,i,r,t.length>0?t.charCodeAt(0):0)}acceptEdit(e,t,n,i,r){this._acceptDeleteRange(e),this._acceptInsertText(new s.L(e.startLineNumber,e.startColumn),t,n,i,r),this._updateEndLineNumber()}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return;const t=e.startLineNumber-this.startLineNumber,n=e.endLineNumber-this.startLineNumber;if(n<0){const e=n-t;return void(this.startLineNumber-=e)}const i=this.tokens.getMaxDeltaLine();if(!(t>=i+1)){if(t<0&&n>=i+1)return this.startLineNumber=0,void this.tokens.clear();if(t<0){const i=-t;this.startLineNumber-=i,this.tokens.acceptDeleteRange(e.startColumn-1,0,0,n,e.endColumn-1)}else this.tokens.acceptDeleteRange(0,t,e.startColumn-1,n,e.endColumn-1)}}_acceptInsertText(e,t,n,i,r){if(0===t&&0===n)return;const s=e.lineNumber-this.startLineNumber;if(s<0)return void(this.startLineNumber+=t);s>=this.tokens.getMaxDeltaLine()+1||this.tokens.acceptInsertText(s,e.column-1,t,n,i,r)}}class _{constructor(e,t){this.startLineNumber=e,this.tokens=t}}function p(e){return e instanceof Uint32Array?e:new Uint32Array(e)}class m{constructor(){this._pieces=[],this._isComplete=!1}flush(){this._pieces=[],this._isComplete=!1}isEmpty(){return 0===this._pieces.length}set(e,t){this._pieces=e||[],this._isComplete=t}setPartial(e,t){let n=e;if(t.length>0){const i=t[0].getRange(),r=t[t.length-1].getRange();if(!i||!r)return e;n=e.plusRange(i).plusRange(r)}let r=null;for(let e=0,t=this._pieces.length;e<t;e++){const i=this._pieces[e];if(i.endLineNumber<n.startLineNumber)continue;if(i.startLineNumber>n.endLineNumber){r=r||{index:e};break}if(i.removeTokens(n),i.isEmpty()){this._pieces.splice(e,1),e--,t--;continue}if(i.endLineNumber<n.startLineNumber)continue;if(i.startLineNumber>n.endLineNumber){r=r||{index:e};continue}const[s,o]=i.split(n);s.isEmpty()?r=r||{index:e}:o.isEmpty()||(this._pieces.splice(e,1,s,o),e++,t++,r=r||{index:e})}return r=r||{index:this._pieces.length},t.length>0&&(this._pieces=i.Zv(this._pieces,r.index,t)),n}isComplete(){return this._isComplete}addSemanticTokens(e,t){const n=this._pieces;if(0===n.length)return t;const i=n[m._findFirstPieceWithLine(n,e)].getLineTokens(e);if(!i)return t;const s=t.getCount(),o=i.getCount();let a=0,l=[],h=0,u=0;const c=(e,t)=>{e!==u&&(u=e,l[h++]=e,l[h++]=t)};for(let e=0;e<o;e++){const n=i.getStartCharacter(e),r=i.getEndCharacter(e),o=i.getMetadata(e),l=((1&o?2048:0)|(2&o?4096:0)|(4&o?8192:0)|(8&o?8372224:0)|(16&o?4286578688:0))>>>0,h=~l>>>0;for(;a<s&&t.getEndOffset(a)<=n;)c(t.getEndOffset(a),t.getMetadata(a)),a++;for(a<s&&t.getStartOffset(a)<n&&c(n,t.getMetadata(a));a<s&&t.getEndOffset(a)<r;)c(t.getEndOffset(a),t.getMetadata(a)&h|o&l),a++;if(a<s)c(r,t.getMetadata(a)&h|o&l),t.getEndOffset(a)===r&&a++;else{const e=Math.min(Math.max(0,a-1),s-1);c(r,t.getMetadata(e)&h|o&l)}}for(;a<s;)c(t.getEndOffset(a),t.getMetadata(a)),a++;return new r.A(new Uint32Array(l),t.getLineContent())}static _findFirstPieceWithLine(e,t){let n=0,i=e.length-1;for(;n<i;){let r=n+Math.floor((i-n)/2);if(e[r].endLineNumber<t)n=r+1;else{if(!(e[r].startLineNumber>t)){for(;r>n&&e[r-1].startLineNumber<=t&&t<=e[r-1].endLineNumber;)r--;return r}i=r-1}}return n}acceptEdit(e,t,n,i,r){for(const s of this._pieces)s.acceptEdit(e,t,n,i,r)}}class L{constructor(){this._lineTokens=[],this._len=0}flush(){this._lineTokens=[],this._len=0}getTokens(e,t,n){let i=null;if(t<this._len&&(i=this._lineTokens[t]),null!==i&&i!==u)return new r.A(p(i),n);let s=new Uint32Array(2);return s[0]=n.length,s[1]=h(e),new r.A(s,n)}static _massageTokens(e,t,n){const i=n?p(n):null;if(0===t){let t=!1;if(i&&i.length>1&&(t=a.NX.getLanguageId(i[1])!==e),!t)return u}if(!i||0===i.length){const n=new Uint32Array(2);return n[0]=t,n[1]=h(e),n.buffer}return i[i.length-2]=t,0===i.byteOffset&&i.byteLength===i.buffer.byteLength?i.buffer:i}_ensureLine(e){for(;e>=this._len;)this._lineTokens[this._len]=null,this._len++}_deleteLines(e,t){0!==t&&(e+t>this._len&&(t=this._len-e),this._lineTokens.splice(e,t),this._len-=t)}_insertLines(e,t){if(0===t)return;let n=[];for(let e=0;e<t;e++)n[e]=null;this._lineTokens=i.Zv(this._lineTokens,e,n),this._len+=t}setTokens(e,t,n,i,r){const s=L._massageTokens(e,n,i);this._ensureLine(t);const o=this._lineTokens[t];return this._lineTokens[t]=s,!!r&&!L._equals(o,s)}static _equals(e,t){if(!e||!t)return!e&&!t;const n=p(e),i=p(t);if(n.length!==i.length)return!1;for(let e=0,t=n.length;e<t;e++)if(n[e]!==i[e])return!1;return!0}acceptEdit(e,t,n){this._acceptDeleteRange(e),this._acceptInsertText(new s.L(e.startLineNumber,e.startColumn),t,n)}_acceptDeleteRange(e){const t=e.startLineNumber-1;if(t>=this._len)return;if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;return void(this._lineTokens[t]=L._delete(this._lineTokens[t],e.startColumn-1,e.endColumn-1))}this._lineTokens[t]=L._deleteEnding(this._lineTokens[t],e.startColumn-1);const n=e.endLineNumber-1;let i=null;n<this._len&&(i=L._deleteBeginning(this._lineTokens[n],e.endColumn-1)),this._lineTokens[t]=L._append(this._lineTokens[t],i),this._deleteLines(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t,n){if(0===t&&0===n)return;const i=e.lineNumber-1;i>=this._len||(0!==t?(this._lineTokens[i]=L._deleteEnding(this._lineTokens[i],e.column-1),this._lineTokens[i]=L._insert(this._lineTokens[i],e.column-1,n),this._insertLines(e.lineNumber,t)):this._lineTokens[i]=L._insert(this._lineTokens[i],e.column-1,n))}static _deleteBeginning(e,t){return null===e||e===u?e:L._delete(e,0,t)}static _deleteEnding(e,t){if(null===e||e===u)return e;const n=p(e),i=n[n.length-2];return L._delete(e,t,i)}static _delete(e,t,n){if(null===e||e===u||t===n)return e;const i=p(e),s=i.length>>>1;if(0===t&&i[i.length-2]===n)return u;const o=r.A.findIndexInTokensArray(i,t),a=o>0?i[o-1<<1]:0;if(n<i[o<<1]){const r=n-t;for(let e=o;e<s;e++)i[e<<1]-=r;return e}let l,h;a!==t?(i[o<<1]=t,l=o+1<<1,h=t):(l=o<<1,h=a);const c=n-t;for(let e=o+1;e<s;e++){const t=i[e<<1]-c;t>h&&(i[l++]=t,i[l++]=i[1+(e<<1)],h=t)}if(l===i.length)return e;let d=new Uint32Array(l);return d.set(i.subarray(0,l),0),d.buffer}static _append(e,t){if(t===u)return e;if(e===u)return t;if(null===e)return e;if(null===t)return null;const n=p(e),i=p(t),r=i.length>>>1;let s=new Uint32Array(n.length+i.length);s.set(n,0);let o=n.length;const a=n[n.length-2];for(let e=0;e<r;e++)s[o++]=i[e<<1]+a,s[o++]=i[1+(e<<1)];return s.buffer}static _insert(e,t,n){if(null===e||e===u)return e;const i=p(e),s=i.length>>>1;let o=r.A.findIndexInTokensArray(i,t);if(o>0){i[o-1<<1]===t&&o--}for(let e=o;e<s;e++)i[e<<1]+=n;return e}}},97461:function(e,t,n){n.d(t,{vu:function(){return i},Af:function(){return r},eq:function(){return s},t2:function(){return a}});const i="`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?";const r=function(e=""){let t="(-?\\d*\\.\\d\\w*)|([^";for(const n of i)e.indexOf(n)>=0||(t+="\\"+n);return t+="\\s]+)",new RegExp(t,"g")}();function s(e){let t=r;if(e&&e instanceof RegExp)if(e.global)t=e;else{let n="g";e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.unicode&&(n+="u"),t=new RegExp(e.source,n)}return t.lastIndex=0,t}const o={maxLen:1e3,windowSize:15,timeBudget:150};function a(e,t,n,i,r=o){if(n.length>r.maxLen){let s=e-r.maxLen/2;return s<0?s=0:i+=s,a(e,t,n=n.substring(s,e+r.maxLen/2),i,r)}const s=Date.now(),h=e-1-i;let u=-1,c=null;for(let e=1;!(Date.now()-s>=r.timeBudget);e++){const i=h-r.windowSize*e;t.lastIndex=Math.max(0,i);const s=l(t,n,h,u);if(!s&&c)break;if(c=s,i<=0)break;u=i}if(c){let e={word:c[0],startColumn:i+1+c.index,endColumn:i+1+c.index+c[0].length};return t.lastIndex=0,e}return null}function l(e,t,n,i){let r;for(;r=e.exec(t);){const t=r.index||0;if(t<=n&&e.lastIndex>=n)return r;if(i>0&&t>i)return null}return null}},14062:function(e,t,n){n.d(t,{W:function(){return i}});class i{constructor(e){this._languageIdentifier=e}getId(){return this._languageIdentifier.language}}}}]);